!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.AILabel=e()}(this,function(){"use strict";var n,o=function(){};n=!1,o.extend=function(t){var i=null;function e(){n||(i&&(this._superprototype=i.prototype),this.init.apply(this,arguments))}for(var r in this!==o&&(i=this),i&&(n=!0,(e.prototype=new i).constructor=e,n=!1),e.extend=o.extend,t)t.hasOwnProperty(r)&&(e.prototype[r]=i&&"function"==typeof t[r]&&"function"==typeof e.prototype[r]&&/\b_super\b/.test(t[r])?function(t,e){return function(){return this._super=i.prototype[t],e.apply(this,arguments)}}(r,t[r]):t[r]);return e};var rt={};function nt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);r=!0);}catch(t){n=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw o}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function r(t,e){var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);r=!0);}catch(t){n=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw o}}return i}function s(t){if(Array.isArray(t))return t}function D(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function e(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function a(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function l(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function z(t,e,i){var r=t.activeFeature,n=t.activePoint,o=r.points[n.relationNodesIndex[0]],s=r.points[n.relationNodesIndex[1]],a=Math.sqrt((o.x-s.x)*(o.x-s.x)+(o.y-s.y)*(o.y-s.y)),l=(o.y-s.y)/a,h=(o.x-s.x)/a;return 1===l&&0===h||-1===l&&0===h?{dltx:e,dlty:0}:0===l&&1===h||0===l&&-1===h?{dltx:0,dlty:i}:{dltx:0,dlty:0}}function E(t){var e=t.activeFeature,i=t.activePoint,r=e.points[i.relationNodesIndex[0]],n=e.points[i.index],o=Math.sqrt((r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y)),s=(r.y-n.y)/o,a=(r.x-n.x)/o;return 0===s&&1===a||0===s&&-1===a?{flag:"y"}:{flag:"x"}}function nt(t,e){return s(t)||r(t,e)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function r(t,e){var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);r=!0);}catch(t){n=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw o}}return i}function s(t){if(Array.isArray(t))return t}function nt(t,e){return s(t)||r(t,e)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function r(t,e){var i=[],r=true,n=false,o=undefined;try{for(var s=t[Symbol.iterator](),a;!(r=(a=s.next()).done);r=true){i.push(a.value);if(e&&i.length===e)break}}catch(t){n=true;o=t}finally{try{if(!r&&s["return"]!=null)s["return"]()}finally{if(n)throw o}}return i}function s(t){if(Array.isArray(t))return t}function D(t){return l(t)||a(t)||e()}function e(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function a(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}function l(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++){i[e]=t[e]}return i}}return rt.config={version:"3.1.10",dpr:window.devicePixelRatio||1},rt.Util={},rt.Util.createDiv=function(t,e,i,r){var n=document.createElement("div");return n.id=t,(e||0===e)&&(n.style.width=e+"px"),(i||0===i)&&(n.style.height=i+"px"),r&&(n.style.position="absolute"),n.style.zIndex=1,n},rt.Util.createSvg=function(t,e,i,r){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.id=t,(e||0===e)&&(n.setAttribute("width",e+"px"),n.style.width=e+"px"),(i||0===i)&&(n.setAttribute("height",i+"px"),n.style.height=i+"px"),r&&(n.style.position="absolute"),n.style.zIndex=1,n.setAttribute("version","1.1"),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n},rt.Util.getDpr=function(){return rt.config.dpr},rt.Util.createCanvas=function(t,e,i,r){var n=document.createElement("canvas"),o=rt.Util.getDpr();return n.id=t,n.width=e*o,n.height=i*o,n.style.width=e+"px",n.style.height=i+"px",r&&(n.style.position="absolute"),n},rt.Util.transformScreenXYWithDpr=function(t){var e=rt.Util.getDpr();return{x:t.x*e,y:t.y*e}},rt.Util.isInArray=function(t,e){for(var i in t)if(t[i]===e)return!0;return!1},rt.Util.isObjInArray=function(t,e){for(var i in t)if(t[i].id===e.id)return alert("已被添加，请更换图层id"+e.id),!0;return!1},rt.Util.setStyle=function(t,e){var i=rt.Util.getDpr();return t.fillStyle=e.fillColor,t.strokeStyle=e.strokeColor,t.lineWidth=e.lineWeight*i,t.globalAlpha=e.opacity,t.lineCap="round",t.lineJoin="round",!0},rt.Util.worldToScreen=function(t,e,i){var r=t.getCenter(),n=r.x,o=r.y,s=parseInt(t.w,10)/2,a=parseInt(t.h,10)/2,l=t.zoom/parseInt(t.w,10);return{x:parseFloat(s)+parseFloat((e-n)/l)+0,y:parseFloat(a)-parseFloat((i-o)/l)+0}},rt.Util.worldToScreenSize=function(t,e,i){var r=t.zoom/parseInt(t.w,10);return{w:parseFloat(e/r),h:parseFloat(i/r)}},rt.Util.screenToWorldDistance=function(t,e){var i=t.zoom/parseInt(t.w,10);return parseFloat((e*i).toFixed(4))},rt.Util.worldToScreenDistance=function(t,e){var i=t.zoom/parseInt(t.w,10);return parseFloat((e/i).toFixed(4))},rt.Util.screenToWorld=function(t,e,i){var r=t.getCenter(),n=r.x,o=r.y,s=parseInt(t.w,10)/2,a=parseInt(t.h,10)/2,l=t.zoom/parseInt(t.w,10),h=parseFloat(n)+parseFloat((e-s)*l),u=parseFloat(o)-parseFloat((i-a)*l);return{x:parseFloat(h.toFixed(4)),y:parseFloat(u.toFixed(4))}},rt.Util.addEvtHandler=function(t,e,i){t["on"+e]=i,"mousewheel"===e&&0===rt.Util.getIEVersion()&&t.addEventListener("DOMMouseScroll",i,!1)},rt.Util.removeEvtHandler=function(t,e){t["on"+e]=null},rt.Util.createEventRegister=function(){return window.addEventListener?function(t,e,i){t.addEventListener(e,i)}:window.attachEvent?function(t,e,i){t.attachEvent("on"+e,function(){i.call(t,window.event)})}:function(t,e,i){t["on"+e]=i}},rt.Util.createEventCancel=function(){return window.addEventListener?function(t,e,i){t.removeEventListener(e,i,!1)}:window.attachEvent?function(t,e,i){t.detachEvent("on"+e,function(){i.call(t,window.event)})}:function(t,e,i){t["on"+e]=null}},rt.Util.addEvtHandlerBAK2=rt.Util.createEventRegister(),rt.Util.removeEvtHandlerBAK2=rt.Util.createEventCancel(),rt.Util.getMouseXY=function(t,e){var i=0,r=0,n=e.srcElement?e.srcElement:e.target;if(1!==n.nodeType)return{x:i,y:r};if(document.attachEvent){var o="medium"===rt.Util.getEleStyle(n,"border-top-width")?0:rt.Util.delpx(rt.Util.getEleStyle(n,"border-top-width")),s="medium"===rt.Util.getEleStyle(n,"border-left-width")?0:rt.Util.delpx(rt.Util.getEleStyle(n,"border-left-width"));i=e.layerX-s,r=e.layerY-o}else{for(;n&&n!==t;){var a="medium"===rt.Util.getEleStyle(n,"border-top-width")?0:rt.Util.delpx(rt.Util.getEleStyle(n,"border-top-width")),l="medium"===rt.Util.getEleStyle(n,"border-left-width")?0:rt.Util.delpx(rt.Util.getEleStyle(n,"border-left-width"));i+=n.offsetLeft+l,r+=n.offsetTop+a,n=n.offsetParent}i=e.offsetX+i+document.body.scrollLeft,r=e.offsetY+r+document.body.scrollTop}return{x:i,y:r}},rt.Util.getMousePos=function(t){var e=t||window.event;return{x:e.screenX,y:e.screenY}},rt.Util.getEleStyle=function(t,e){var i=e.split("-"),r=i[0];if(1<r.length)for(var n=1;n<i.length;n++)r+=i[n].substring(0,1).toUpperCase()+i[n].substring(1);else r=e;return t.currentStyle?t.currentStyle[r]:document.defaultView.getComputedStyle(t,!1)[r]},rt.Util.delpx=function(t){return t?parseInt(t.substring(0,t.length-2),10):0},rt.Util.getRectPointsWithSAndE=function(t,e){var i=e.x,r=t.y,n=t.x,o=e.y;return[{x:t.x,y:t.y},{x:i,y:r},{x:e.x,y:e.y},{x:n,y:o}]},rt.Util.pointInPoly=function(t,e){for(var i=!1,r=-1,n=e.length,o=n-1;++r<n;o=r)(e[r].y<=t.y&&t.y<e[o].y||e[o].y<=t.y&&t.y<e[r].y)&&t.x<(e[o].x-e[r].x)*(t.y-e[r].y)/(e[o].y-e[r].y)+e[r].x&&(i=!i);return i},rt.Util.preventDefault=function(t){t.preventDefault?t.preventDefault():window.event.returnValue=!1},rt.Util.stopPropagation=function(t){t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0},rt.Util.getButton=function(t){if(t=t||window.event,!+[1])switch(t.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}return t.button},rt.Util.createTextArea=function(t,e,i,r){var n=document.createElement("textarea");return n.id=t,n.style.width=e+"px",n.style.height=i+"px",n.style.resize="none",r&&(n.style.position="absolute"),n.style.zIndex=1,n},rt.Util.colorRgb=function(t,e){return"rgba("+parseInt("0x"+t.slice(1,3),10)+","+parseInt("0x"+t.slice(3,5),10)+","+parseInt("0x"+t.slice(5,7),10)+","+e+")"},rt.Util.getIEVersion=function(){var t=window.navigator.userAgent.toLowerCase();return/msie 8\.0/i.test(t)?8:/msie 7\.0/i.test(t)?7:/msie 6\.0/i.test(t)?6:0},rt.Util.formatGeoPointsWithDlt=function(t,e,i,r){for(var n=e.length,o=t.getZoom()/t.getSize().w,s=i*o,a=r*o,l=[],h=0;h<n;h++){var u=e[h];l.push({x:u.x+s,y:u.y-a})}return l},rt.Util.formatGeoPointsWithDeleteIndex=function(t,e,i){for(var r=t.length,n=i||3,o=[],s=0;s<r;s++){var a=t[s];(s!==e||r<=n)&&o.push({x:a.x,y:a.y})}return o},rt.Util.calRectNewPointsWithNodesIndexTmpPoint=function(t,e,i,r,n){for(var o=e.length,s=t.getZoom()/t.getSize().w,a=r*s,l=n*s,h=[],u=[],c=0;c<o;c++){var d=e[c],y=rt.Util.worldToScreen(t,d.x,d.y);-1!==i.indexOf(c)?(h.push({x:d.x+a,y:d.y-l}),u.push({x:y.x+r,y:y.y+n})):(h.push({x:d.x,y:d.y}),u.push({x:y.x,y:y.y}))}return{points:h,sPoints:u}},rt.Util.calPolygonNewPointsWithNodesIndexTmpPoint=function(t,e,i,r){for(var n=e.length,o=[],s=[],a=0;a<n;a++){var l=e[a],h=rt.Util.worldToScreen(t,l.x,l.y);if(o.push({x:l.x,y:l.y}),s.push({x:h.x,y:h.y}),a===i){o.push({x:r.x,y:r.y});var u=rt.Util.worldToScreen(t,r.x,r.y);s.push({x:u.x,y:u.y})}}return{points:o,sPoints:s}},rt.Util.calRectNewPointsWithNodesIndexFormalPoint=function(t,e,i,r,n,o,s){for(var a=e.length,l=t.getZoom()/t.getSize().w,h=n*l,u=o*l,c=[],d=[],y=0;y<a;y++){var f=e[y],p=rt.Util.worldToScreen(t,f.x,f.y),g=i.indexOf(y);"y"===s&&0===g||"x"===s&&1===g?(c.push({x:f.x,y:f.y-u}),d.push({x:p.x,y:p.y+o})):"y"===s&&1===g||"x"===s&&0===g?(c.push({x:f.x+h,y:f.y}),d.push({x:p.x+n,y:p.y})):y===r?(c.push({x:f.x+h,y:f.y-u}),d.push({x:p.x+n,y:p.y+o})):(c.push({x:f.x,y:f.y}),d.push({x:p.x,y:p.y}))}return{points:c,sPoints:d}},rt.Util.calPolygonNewPointsWithNodesIndexFormalPoint=function(t,e,i,r,n){for(var o=e.length,s=t.getZoom()/t.getSize().w,a=r*s,l=n*s,h=[],u=[],c=0;c<o;c++){var d=e[c],y=rt.Util.worldToScreen(t,d.x,d.y);c===i?(h.push({x:d.x+a,y:d.y-l}),u.push({x:y.x+r,y:y.y+n})):(h.push({x:d.x,y:d.y}),u.push({x:y.x,y:y.y}))}return{points:h,sPoints:u}},rt.Util.getBounds=function(t){if(!t.length)return[];for(var e=t[0].x,i=t[0].y,r=t[0].x,n=t[0].y,o=1;o<t.length;o++)e>t[o].x&&(e=t[o].x),r<t[o].x&&(r=t[o].x),i>t[o].y&&(i=t[o].y),n<t[o].y&&(n=t[o].y);return[{x:e,y:n},{x:r,y:n},{x:r,y:i},{x:e,y:i}]},rt.Util.Key={},rt.Util.Key.EVENT="on",rt.Util.Key.FLAG={},rt.Util.Key.EVENTS={},rt.Util.Key.addEventListener=function(t,e){var i=t.join("_");rt.Util.Key.EVENTS[i]=e},rt.Util.Key.removeEventListener=function(t){var e=t.join("_");delete rt.Util.Key.EVENTS[e]},document.addEventListener("keydown",function(t){var e=t.keyCode;if(rt.Util.Key.FLAG[e]=!0,"off"!==rt.Util.Key.EVENT)for(var i in rt.Util.Key.EVENTS){var r=i.split("_"),n=rt.Util.Key.EVENTS[i],o=!0;r.forEach(function(t){rt.Util.Key.FLAG[1*t]||(o=!1)}),o&&n()}}),document.addEventListener("keyup",function(t){var e=t.keyCode;rt.Util.Key.FLAG[e]=!1}),rt.Util.Key.isActive=function(t){return rt.Util.Key.FLAG[t+""]},rt.Util.getCirclePoints=function(t,e,i){for(var r=parseInt(360/i,10),n=[],o=0;o<i;o++){var s=o*r,a=t.x+Math.cos(2*Math.PI/360*s)*e,l=t.y+Math.sin(2*Math.PI/360*s)*e;n.push({x:parseFloat(a.toFixed(2)),y:parseFloat(l.toFixed(2))})}return n},rt.Util.combinePolygons=function(t){if(t.length<1)return[];if(1===t.length)return t[0];for(var e=t[0].map(function(t){return[t.x,t.y]}),i=PolyBool.segments({regions:[e],inverted:!1}),r=1,n=t.length;r<n;r++){var o=t[r].map(function(t){return[t.x,t.y]}),s=PolyBool.segments({regions:[o],inverted:!1}),a=PolyBool.combine(i,s);i=PolyBool.selectUnion(a)}return(PolyBool.polygon(i).regions[0]||[]).map(function(t){return{x:t[0],y:t[1]}})},rt.Util.colorRGB2Hex=function(t){var e=t.split(",");return"#"+((1<<24)+(parseInt(e[0].split("(")[1],10)<<16)+(parseInt(e[1],10)<<8)+parseInt(e[2].split(")")[0],10)).toString(16).slice(1)},rt.Util.colorRGB2Hex2=function(t,e,i){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},rt.Graph={},rt.Graph.drawPoint=function(t,e,i){var r=rt.Util.transformScreenXYWithDpr(e),n=rt.Util.getDpr();t.beginPath(),t.arc(r.x,r.y,(i||3)*n,0,2*Math.PI,!0),t.closePath(),t.fill()},rt.Graph.drawPoints=function(t,e,i){for(var r=0;r<e.length;r++){var n={x:e[r].x,y:e[r].y};this.drawPoint(t,n,i)}},rt.Graph.drawGeoPoint=function(t,e,i,r){var n=rt.Util.worldToScreen(t,i.x,i.y),o=rt.Util.transformScreenXYWithDpr(n),s=rt.Util.getDpr();e.beginPath(),e.arc(o.x,o.y,(r||3)*s,0,2*Math.PI,!0),e.closePath(),e.fill()},rt.Graph.drawGeoPoints=function(t,e,i,r){for(var n=0;n<i.length;n++){var o=rt.Util.worldToScreen(t,i[n].x,i[n].y);this.drawPoint(e,o,r)}},rt.Graph.drawLine=function(t,e,i){t.beginPath();var r=rt.Util.transformScreenXYWithDpr(e),n=rt.Util.transformScreenXYWithDpr(i);t.moveTo(r.x,r.y),t.lineTo(n.x,n.y),t.stroke()},rt.Graph.drawLines=function(t,e){if(!(e.length<2)){t.beginPath();var i=rt.Util.transformScreenXYWithDpr(e[0]);t.moveTo(i.x,i.y);for(var r=1;r<e.length;r++){var n=rt.Util.transformScreenXYWithDpr(e[r]);t.lineTo(n.x,n.y)}t.stroke()}},rt.Graph.drawLines2=function(t,e){if(!(e.length<2)){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.stroke()}},rt.Graph.drawGeoLine=function(t,e,i,r){e.beginPath();var n=rt.Util.worldToScreen(t,i.x,i.y),o=rt.Util.worldToScreen(t,r.x,r.y);rt.Graph.drawLine(e,n,o)},rt.Graph.drawGeoLines=function(t,e,i){if(!(i.length<2)){e.beginPath();var r=rt.Util.worldToScreen(t,i[0].x,i[0].y),n=rt.Util.transformScreenXYWithDpr(r);e.moveTo(n.x,n.y);for(var o=1;o<i.length;o++){var s=rt.Util.worldToScreen(t,i[o].x,i[o].y),a=rt.Util.transformScreenXYWithDpr(s);e.lineTo(a.x,a.y)}e.stroke()}},rt.Graph.drawRect=function(t,e,i,r){var n=rt.Util.getDpr(),o=rt.Util.transformScreenXYWithDpr(e);t.strokeRect(o.x,o.y,i*n,r*n)},rt.Graph.drawGeoRect=function(t,e,i,r,n){var o=rt.Util.getDpr(),s=rt.Util.worldToScreen(t,i.x,i.y),a=rt.Util.worldToScreenSize(t,r,n),l=rt.Util.transformScreenXYWithDpr(s);e.strokeRect(l.x,l.y,a.w*o,a.h*o)},rt.Graph.drawPolygon=function(t,e,i){var r=e.length;if(2<=r){t.beginPath();var n=rt.Util.transformScreenXYWithDpr(e[0]);t.moveTo(n.x,n.y);for(var o=1;o<r;o++)n=rt.Util.transformScreenXYWithDpr(e[o]),t.lineTo(n.x,n.y);t.closePath()}!i&&t.stroke()},rt.Graph.drawGeoLineWith=function(t,e,i,r){var n=rt.Util.worldToScreen(t,i.x,i.y),o=rt.Util.worldToScreen(t,r.x,r.y),s=rt.Util.transformScreenXYWithDpr(n),a=rt.Util.transformScreenXYWithDpr(o);e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(a.x,a.y),e.closePath(),e.stroke()},rt.Graph.drawGeoPolygon=function(t,e,i,r){var n=i.length;if(2<=n){e.beginPath();var o=rt.Util.worldToScreen(t,i[0].x,i[0].y),s=rt.Util.transformScreenXYWithDpr(o);e.moveTo(s.x,s.y);for(var a=1;a<n;a++){var l=rt.Util.worldToScreen(t,i[a].x,i[a].y),h=rt.Util.transformScreenXYWithDpr(l);e.lineTo(h.x,h.y)}e.closePath()}e.stroke(),r&&e.fill()},rt.Graph.drawDashGeoPolygon=function(t,e,i){var r=i.length;if(2<=r){e.beginPath();var n=rt.Util.worldToScreen(t,i[0].x,i[0].y),o=rt.Util.transformScreenXYWithDpr(n);e.moveTo(o.x,o.y);for(var s=1;s<r;s++){var a=rt.Util.worldToScreen(t,i[s].x,i[s].y),l=rt.Util.transformScreenXYWithDpr(a);if(e.lineTo(l.x,l.y),s===r-1){if(e.stroke(),r<=2)return;var h=e.globalAlpha;e.setLineDash([10,20]),e.globalAlpha=.3,e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(o.x,o.y),e.stroke(),e.setLineDash([]),e.globalAlpha=h}}}},rt.Graph.drawText=function(t,e,i,r){var n=rt.Util.transformScreenXYWithDpr({x:i,y:r});e.fillText(t,n.x,n.y)},rt.Graph.drawGeoText=function(t,e,i,r,n){var o=rt.Util.worldToScreen(t,r,n),s=rt.Util.transformScreenXYWithDpr(o);i.fillText(e,s.x,s.y)},rt.Graph.clearArc=function(t,e,i,r,n,o){r.save(),r.beginPath(),r.arc(t,e,i,0,2*Math.PI),r.clip(),r.clearRect(0,0,n,o),r.restore()},rt.Graph.clearPolygon=function(t,e,i,r){e.save(),e.beginPath(),rt.Graph.drawPolygon(e,t,!0),e.clip(),e.clearRect(0,0,i,r),e.restore()},rt.Geometry=o.extend({init:function(t){this.name=t},getVertices:function(){},getBounds:function(){},calcBounds:function(){}}),rt.Geometry.Point=o.extend({init:function(t,e){this.x=t,this.y=e,this.className="point"}}),rt.Geometry.LineString=rt.Geometry.extend({init:function(t){this.className="line",this.points=[];for(var e=0;e<t.length;e++){var i=t[e];i instanceof rt.Geometry.Point?this.points.push(i):alert("初始化节点失败！")}},addPoint:function(t,e){/^\d+$/.test(e)?this.points.splice(e,0,t):this.points.push(t)},delPoint:function(t){this.points.splice(t,1)},removePoint:function(t){for(var e=0;e<this.points.length;e++)if(this.points[e]===t){this.points.splice(e,1);break}},getLength:function(){for(var t=this.points.length,e=0,i=0;i<t-1;i++){e+=Math.sqrt((this.points[i].x-this.points[i+1].x)*(this.points[i].x-this.points[i+1].x)+(this.points[i].y-this.points[i+1].y)*(this.points[i].y-this.points[i+1].y))}return e}}),rt.Geometry.LinearRing=rt.Geometry.LineString.extend({init:function(t){if(t.length<=2)alert("组成多边形节点个数不足！");else{this._super(t),this.className="polygon";var e=t[0];this.points.push(e)}},addPoint:function(t,e){this.points.splice(e,0,t)},delPoint:function(t){if(4!==this.points.length){if(this.points.splice(t,1),0===t){this.points.pop();var e=this.points[0];this.points.push(e)}}else alert("节点数低于3个，不能删除！")},getCenterPoint:function(){for(var t=this.points,e=t.length,i=0,r=0,n=0;n<e;n++)i+=t[n].x,r+=t[n].y;var o=i/e,s=r/e;return new rt.Geometry.Point(o,s)},getArea:function(){for(var t=0,e=this.points,i=0;i<e.length;i++)t+=e[i].x*e[(i+1)%e.length].y-e[(i+1)%e.length].x*e[i].y;return parseInt(Math.abs(.5*t),10)}}),rt.Geometry.RectRing=rt.Geometry.LineString.extend({init:function(t){t.length<4?alert("组成矩形节点个数不足！"):(this._super(t),this.className="rect")},addPoint:function(t,e){this.points.splice(e,0,t)},delPoint:function(t){if(4!==this.points.length){if(this.points.splice(t,1),0===t){this.points.pop();var e=this.points[0];this.points.push(e)}}else alert("节点数低于3个，不能删除！")},getArea:function(){for(var t=0,e=this.points,i=0;i<e.length;i++)t+=e[i].x*e[(i+1)%e.length].y-e[(i+1)%e.length].x*e[i].y;return parseInt(Math.abs(.5*t),10)}}),rt.Geometry.RadiusRing=rt.Geometry.extend({init:function(t,e){this.radius=e,this.centerPoint=t,this.className="radius"},getArea:function(){return 6.28318*this.radius*this.radius}}),rt.Feature=o.extend({init:function(t,e,i,r,n){this.activeStatus=!1,this.hoverStatus=!1,this.visible=!1,this.id=t,this.points=e instanceof Array?e:[e],this.data=i||{},this.gStyle=r,this.options=n||{}},onAdd:function(t){this._layerID=t.id,this._layer=t,this.visible=!0,this.setEditVertices(),this.style=this.gStyle||t.featureStyle||new rt.Style({}),this.hoveStyle=t.featureHoverStyle||new rt.Style({strokeColor:"#FF0000",lineWeight:1}),this.activeStyle=t.featureActiveStyle||new rt.Style({strokeColor:"#FF0000",lineWeight:1}),this.onDraw(t)},onRemove:function(t){},getVertices:function(){return this.points},setEditVertices:function(){var t=this.points,e=t.length,i=this._layer.getMap(),r="point"===this.type,n="polyline"===this.type,o=[];if(r)return o;for(var s=0;s<e-1;s++){var a=t[s],l=t[s+1],h=-1<s-1?s-1:n?void 0:e-1,u=void 0===h?void 0:(t[h].y-l.y)/(t[h].x-l.x);o.push({point:a,sPoint:rt.Util.worldToScreen(i,a.x,a.y),type:"formal",index:s,k:u?-1/u:void 0,relationNodesIndex:[h,s+1]});var c={x:(a.x+l.x)/2,y:(a.y+l.y)/2},d=(l.y-a.y)/(l.x-a.x);if(o.push({point:c,sPoint:rt.Util.worldToScreen(i,c.x,c.y),type:"tmp",index:s,k:-1/d,relationNodesIndex:[s,s+1]}),s===e-2){var y=n?void 0:0,f=void 0===y?void 0:(t[y].y-a.y)/(t[y].x-a.x);if(o.push({point:l,sPoint:rt.Util.worldToScreen(i,l.x,l.y),type:"formal",index:s+1,k:f?-1/f:void 0,relationNodesIndex:[s,y]}),!n){var p=t[y],g={x:(p.x+l.x)/2,y:(p.y+l.y)/2},v=(t[y].y-l.y)/(t[y].x-l.x);o.push({point:g,sPoint:rt.Util.worldToScreen(i,g.x,g.y),type:"tmp",index:s,k:-1/v,relationNodesIndex:[s+1,y]})}}}this._editPoints=o},catchPointWithPos:function(t){if(!this.visible||"point"===this.type)return{flag:!1,point:null};for(var e=this._editPoints,i=this._layer.getMap(),r=rt.Util.worldToScreen(i,t.x,t.y),n=e.length,o=0;o<n;o++){var s=e[o].sPoint,a=(r.x-s.x)*(r.x-s.x)+(r.y-s.y)*(r.y-s.y);if(Math.sqrt(a)<=10)return{flag:!0,point:e[o]}}return{flag:!1,point:null}},show:function(){this.visible||(this.visible=!0,this._layer.renew())},hide:function(){this.visible&&(this.visible=!1,this._layer.renew())},update:function(t){"point"===this.type?this.points=t.point?t.point instanceof Array?t.point:[t.point]:this.points:this.points=t.points?t.points instanceof Array?t.points:[t.points]:this.points,this.data=t.data||this.data,this.style=t.style||this.style,t.points&&this.setEditVertices(),this._layer.renew()},hover:function(t){this.hoverStatus||(this.hoveStyle=t||this.hoveStyle,this.hoverStatus=!0,this._layer.renew())},deHover:function(){this.hoverStatus&&(this.hoverStatus=!1,this._layer.renew())},active:function(t){this.activeStatus||"point"===this.type||(this.activeStyle=t||this.activeStyle,this.activeStatus=!0,this._layer.renew())},deActive:function(){this.activeStatus&&"point"!==this.type&&(this.activeStatus=!1,this._layer.renew())},getStyle:function(){return this.activeStatus||this.hoverStatus,this.style},getBounds:function(){for(var t=this.getVertices(),e=t[0].x,i=t[0].y,r=t[0].x,n=t[0].y,o=1;o<t.length;o++)e>t[o].x&&(e=t[o].x),r<t[o].x&&(r=t[o].x),i>t[o].y&&(i=t[o].y),n<t[o].y&&(n=t[o].y);return[{x:e,y:n},{x:r,y:n},{x:r,y:i},{x:e,y:i}]},setVerticesActiveStatus:function(){if(this.activeStatus){var t=this._layer.getCtx(),e=this._layer.getMap(),i=this._editPoints.filter(function(t){return"formal"===t.type}),r=this._editPoints.filter(function(t){return"tmp"===t.type});t.globalAlpha=1,t.fillStyle="#FF0000",rt.Graph.drawGeoPoints(e,t,i.map(function(t){return t.point})),t.globalAlpha=1,t.fillStyle="#FF9900",rt.Graph.drawGeoPoints(e,t,r.map(function(t){return t.point}))}}}),rt.Feature.Close=rt.Feature.extend({isCaught:function(t){return!(!rt.Util.pointInPoly(t,this.points)||!this.visible)},getStyleSize:function(){var t=rt.Util.getDpr();return this.style.lineWeight*t},onDraw:function(t){if(this.visible){var e=t.getCtx(),i=this.getStyle(),r=rt.Util.getDpr();rt.Util.setStyle(e,i),this.hoverStatus&&!this.activeStatus&&(e.lineWidth=2*i.lineWeight*r),i.lineDash?e.setLineDash([10,5]):e.setLineDash([]),e.globalAlpha=1,this.activeStatus&&(e.strokeStyle=this.options.activeColor||"#FF0000");var n=this.points.length;if(2<=n){e.beginPath();var o=rt.Util.worldToScreen(t._map,this.points[0].x,this.points[0].y),s=rt.Util.transformScreenXYWithDpr(o);e.moveTo(s.x,s.y);for(var a=1;a<n;a++)o=rt.Util.worldToScreen(t._map,this.points[a].x,this.points[a].y),s=rt.Util.transformScreenXYWithDpr(o),e.lineTo(s.x,s.y);e.closePath()}e.stroke(),t._opacity?e.globalAlpha=0:e.globalAlpha=this.style.opacity,e.fill(),this.setVerticesActiveStatus()}}}),rt.Feature.Rect=rt.Feature.Close.extend({init:function(t,e,i,r,n){this._super(t,e,i,r,n),this.type="rect"}}),rt.Feature.Polygon=rt.Feature.Close.extend({init:function(t,e,i,r,n){this._super(t,e,i,r,n),this.type="polygon"}}),rt.Feature.Point=rt.Feature.extend({init:function(t,e,i,r,n){this._super(t,e,i,r,n);var o=(n||{}).radius;this.radius=o,this.type="point"},getStyleSize:function(){var t=this._layer.getMap();return this.radius&&0<this.radius?rt.Util.worldToScreenDistance(t,this.radius):this.style.pointRadius},isCaught:function(t){var e=this.points[0],i=this._layer.getMap(),r=e.x,n=e.y,o=t.x,s=t.y,a=Math.abs(o-r),l=Math.abs(s-n),h=Math.sqrt(Math.pow(a,2)+Math.pow(l,2));return rt.Util.worldToScreenDistance(i,h)-this.getStyleSize()<=4},onDraw:function(t){if(this.visible){var e=this.getStyle(),i=t.getMap(),r=t.getCtx(),n=this.points[0],o=this.getStyleSize();rt.Util.setStyle(r,e),rt.Graph.drawGeoPoint(i,r,n,o)}}}),rt.Feature.Polyline=rt.Feature.extend({init:function(t,e,i,r,n){this._super(t,e,i,r,n);var o=(n||{}).width;this.lineWidth=o,this.type="polyline"},getStyleSize:function(){var t=rt.Util.getDpr(),e=this._layer.getMap();return this.lineWidth&&0<this.lineWidth?rt.Util.worldToScreenDistance(e,this.lineWidth)*t:this.style.lineWeight*t},isCaught:function(t){return!(!this.isCaughtInner(t)||!this.visible)},isCaughtInner:function(t){for(var e=1e7,i=this._layer.getMap(),r=this.points,n=r.length-1,o=t.x,s=t.y,a=0;a<n;a++){var l=r[a],h=r[a+1],u=void 0,c=(h.x-l.x)*(o-l.x)+(h.y-l.y)*(s-l.y),d=(h.x-l.x)*(h.x-l.x)+(h.y-l.y)*(h.y-l.y);if(c<=0)u=Math.sqrt((o-l.x)*(o-l.x)+(s-l.y)*(s-l.y));else if(d<=c)u=Math.sqrt((o-h.x)*(o-h.x)+(s-h.y)*(s-h.y));else{var y=c/d,f=l.x+(h.x-l.x)*y,p=l.y+(h.y-l.y)*y;u=Math.sqrt((o-f)*(o-f)+(p-s)*(p-s))}u<e&&(e=u)}if(this.lineWidth){var g=e-this.lineWidth/2;return g<=0||rt.Util.worldToScreenDistance(i,g)<=4}return rt.Util.worldToScreenDistance(i,e)<=4},onDraw:function(t){if(this.visible){var e=t.getMap(),i=t.getCtx(),r=this.getStyle(),n=rt.Util.getDpr();if(rt.Util.setStyle(i,r),this.lineWidth&&0<this.lineWidth){var o=rt.Util.worldToScreenDistance(e,this.lineWidth);i.lineWidth=o*n}i.globalAlpha=1,this.hoverStatus&&!this.activeStatus&&(i.globalAlpha=.9),this.activeStatus&&(i.strokeStyle=this.options.activeColor||"#FF0000");var s=this.points.length;if(2<=s){i.beginPath();var a=rt.Util.worldToScreen(t._map,this.points[0].x,this.points[0].y),l=rt.Util.transformScreenXYWithDpr(a);i.moveTo(l.x,l.y);for(var h=1;h<s;h++)a=rt.Util.worldToScreen(t._map,this.points[h].x,this.points[h].y),l=rt.Util.transformScreenXYWithDpr(a),i.lineTo(l.x,l.y)}i.stroke(),t._opacity?i.globalAlpha=0:i.globalAlpha=this.style.opacity,this.setVerticesActiveStatus()}}}),rt.Marker=o.extend({init:function(t,e){this.id=t,this._img=new Image,this._img.src=e.src,this.src=e.src,this._img.style.position="absolute",this._img.style.zIndex=100,this.info=e},onAdd:function(t){var e=(this._layer=t).getMap(),i=this._container=t.getLayerContainer();this.x=this.info.x,this.y=this.info.y;var r=rt.Util.worldToScreen(e,this.info.x,this.info.y);this._img.style.left=r.x+this.info.offset.x+"px",this._img.style.top=r.y+this.info.offset.y+"px",this._img.style.cursor="pointer",i.appendChild(this._img)},onRemove:function(){this._container.removeChild(this._img)},update:function(t){t.src&&(this._img.src=t.src),t.x&&(this.info.x=t.x),t.y&&(this.info.y=t.y),t.offset&&(this.info.offset=t.offset),this.renew()},regEvent:function(t,e){if("click"===t){var i=this;rt.Util.addEvtHandler(this._img,"mousedown",function(t){rt.Util.preventDefault(t),rt.Util.stopPropagation(t)}),rt.Util.addEvtHandler(this._img,"mouseup",function(t){0===rt.Util.getButton(t)&&e.apply(i,arguments),rt.Util.preventDefault(t),rt.Util.stopPropagation(t)}),rt.Util.addEvtHandler(this._img,"click",function(t){rt.Util.preventDefault(t),rt.Util.stopPropagation(t)})}},renew:function(){var t=this._layer.getMap(),e=rt.Util.worldToScreen(t,this.info.x,this.info.y);this._img.style.left=e.x+this.info.offset.x+"px",this._img.style.top=e.y+this.info.offset.y+"px"},showInfo:function(){console.log("Hello ...")}}),rt.Text=o.extend({init:function(t,e,i){this.id=t,this.startPoint=e.pos,this.offset=e.offset||{x:0,y:0},this.boxWidth="auto",this.boxMaxWidth="initial",this.visible=![!0,!1].includes(e.visible)||e.visible,e.width||0===e.width?this.boxWidth=e.width:(e.maxWidth||0===e.maxWidth)&&(this.boxMaxWidth=e.maxWidth),this.wrap=e.wrap||!1,this.text=e.text,this.style=i||new rt.Style({})},onAdd:function(t){var e=this.id,i=rt.Util.createDiv(e,void 0,void 0,!0);i.style.borderWidth=0,this.wrap||(i.style.overflow="hidden",i.style.textOverflow="ellipsis",i.style.whiteSpace="nowrap"),this._textContainer=i,(this._container=t.getLayerContainer()).appendChild(this._textContainer),this._layer=t,this.onDraw(t)},update:function(t){t.pos&&(this.startPoint=t.pos),t.offset&&(this.offset=t.offset),t.text&&(this.text=t.text),t.width&&(this.boxWidth=t.width),t.maxWidth&&(this.boxMaxWidth=t.maxWidth),t.style&&(this.style=t.style),this.renew()},show:function(){this.visible=!0,this.renew()},hide:function(){this.visible=!1,this.renew()},onDraw:function(t){var e=rt.Util.worldToScreen(t._map,this.startPoint.x,this.startPoint.y);e.x=e.x+this.offset.x,e.y=e.y+this.offset.y,this._textContainer.style.fontSize=this.style.fontSize+"px",this._textContainer.style.lineHeight=this.style.fontSize+"px",this._textContainer.style.fontFamily=this.style.fontFamily+",SimSun",this._textContainer.style.color=this.style.fontColor,this._textContainer.style.borderRadius="1px",this._textContainer.style.boxSizing="border-box",this._textContainer.style.padding="1px",this._textContainer.style.width="auto"===this.boxWidth?"auto":"".concat(this.boxWidth,"px"),this._textContainer.style.maxWidth="initial"===this.boxMaxWidth?"initial":"".concat(this.boxMaxWidth,"px"),this._textContainer.style.background=this.style.bgColor,this._textContainer.textContent=this.text,this.text&&this.visible?this._textContainer.style.display="block":this._textContainer.style.display="none",this._textContainer.style.left=e.x+"px",this._textContainer.style.top=e.y+"px",t._layerContainer.appendChild(this._textContainer)},setText:function(t){this.text=t,this.refresh()},setPosition:function(t,e){this.startPoint.x=t,this.startPoint.y=e},setSize:function(t){var e=t.width,i=t.maxWidth;(e||0===e)&&(this.boxWidth=e),(i||0===i)&&(this.boxMaxWidth=i)},onRemove:function(){this._container.removeChild(this._textContainer)},getContainer:function(){return this._textContainer},renew:function(){var t=this._layer;this.onDraw(t)},refresh:function(){this.renew()}}),rt.Style=o.extend({init:function(t){this.oStyle="singleStyle",this.fillColor=t.fillColor?t.fillColor:"#00DD00",this.strokeColor=t.strokeColor?t.strokeColor:"#00DD00",this.lineWeight=t.lineWeight?t.lineWeight:1,this.borderStatus=!t.borderStatus||t.borderStatus,this.pointRadius=t.pointRadius?t.pointRadius:3,this.cirRadius=t.cirRadius?t.cirRadius:3,this.fillStatus=!t.fillStatus||t.fillStatus,this.vtxStatus=!!t.vtxStatus&&t.vtxStatus,this.vtxRadius=t.vtxRadius?t.vtxRadius:3,this.tlr=t.tlr?t.tlr:5,this.opacity=t.opacity||0===t.opacity?t.opacity:1,this.mappingValue=t.mappingValue?t.mappingValue:"default",this.fontSize=t.fontSize?t.fontSize:13,this.fontFamily=t.fontFamily?t.fontFamily:"KaiTi",this.fontColor=t.fontColor?t.fontColor:"#333333",this.bgColor=t.bgColor?t.bgColor:"#ffffff",this.lineDash=t.lineDash||!1}}),rt.StyleEx=o.extend({init:function(t,e){this.oStyle="multiStyles",this.styles=t,this.mappingField=e}}),rt.Edit={},rt.Edit.mouseDown=function(t,e){var i=rt.Util.getMouseXY(t._container,e),r=rt.Util.screenToWorld(t,i.x,i.y),n=t.mode;switch(rt.Edit.setDrawStyle(t),rt.Edit.setDrawMaskStyle(t),n){case"drawPoint":case"drawRect":case"drawPolygon":case"drawPolyline":case"drawMask":var o=rt.Util.getButton(e),s=t.activeFeature,a=t.hoverFeature;if(s){var l=s.type;if("rect"===l)t.dragging=!0;else if("polygon"===l||"polyline"===l){var h=t.activePoint;if(h&&"formal"===h.type&&2===o){var u=s.points,c=rt.Util.formatGeoPointsWithDeleteIndex(u,t.activePoint.index,"polyline"===l?2:3);t.userGeometryEditDone&&t.userGeometryEditDone(l,s,c)}else t.dragging=!0}}else if(a&&"point"===a.type&&2===o)t.userGeometryRemove&&t.userGeometryRemove("point",a),t.tipLayer.clear();else{var d=t.resetLayerStatus("active"),y=new rt.Geometry.Point(r.x,r.y);if(d)return void t.resetLayerStatus("active");"drawPoint"===n&&(t.drawGeometryPoints=[],t.drawGeometryPoints.push(y)),"drawRect"===n?t.drawGeometryPoints.push(y):"drawPolygon"===n?(t.tipLayer.setGeoText("ctrl+z撤销",r.x,r.y),t.drawGeometryPoints.push(y)):"drawPolyline"===n?(t.tipLayer.setGeoText("ctrl+z撤销",r.x,r.y),t.drawGeometryPoints.push(y)):"drawMask"===n&&rt.Edit.storeAndDrawMaskLines(t,r,!0)}break;case"clearMask":rt.Edit.storeAndClearMaskLines(t,r,i,!0)}},rt.Edit.mouseMove=function(t,e){var i=t.overLayer.getCtx(),r=e.srcElement?rt.Util.getMouseXY(t._container,e):e,n=rt.Util.screenToWorld(t,r.x,r.y),o=t.mode,s=t.startX,a=t.startY,l=r.x-s,h=r.y-a,u=t.drawGeometryPoints,c=u.length;switch(o){case"drawPoint":case"drawRect":case"drawPolygon":case"drawPolyline":case"drawMask":t.overLayer.clear(),t.tipLayer.clear();var d=t.activeFeature,y=t.hoverFeature;if(d){var f=t.activePoint,p=d.points,g=d.type;if(t.dragging){t.overLayer.setEditStyle(),t.overLayer.topzIndex();var v=d.getStyleSize();if(i.lineWidth=v,f){var m=[],x=t.activePoint,w=x.type,_=x.relationNodesIndex,C=x.index;if("tmp"===w)if("rect"===g){var S=z(t,l,h);m=rt.Util.calRectNewPointsWithNodesIndexTmpPoint(t,p,_,S.dltx,S.dlty)}else"polygon"!==g&&"polyline"!==g||(m=rt.Util.calPolygonNewPointsWithNodesIndexTmpPoint(t,p,_[0],n));else if("formal"===w)if("rect"===g){var P=E(t);m=rt.Util.calRectNewPointsWithNodesIndexFormalPoint(t,p,_,C,l,h,P.flag)}else"polygon"!==g&&"polyline"!==g||(m=rt.Util.calPolygonNewPointsWithNodesIndexFormalPoint(t,p,C,l,h));var b="polyline"===g?"drawLines":"drawPolygon";rt.Graph[b](i,m.sPoints),t.userGeometryEditing&&t.userGeometryEditing(g,d,m.points)}else{var U=rt.Util.formatGeoPointsWithDlt(t,p,l,h),M="polyline"===g?"drawGeoLines":"drawGeoPolygon";rt.Graph[M](t,i,U),t.userGeometryEditing&&t.userGeometryEditing(g,d,U)}}else f&&"formal"===f.type&&(3<p.length&&"polygon"===g||2<p.length&&"polyline"===g)&&t.tipLayer.setGeoText("右键删除节点",n.x,n.y)}else if(0<c)if(t.overLayer.topzIndex(),"drawRect"===o){var T=[u[0],{x:n.x,y:u[0].y},n,{x:u[0].x,y:n.y}];rt.Graph.drawGeoPolygon(t,i,T)}else if("drawPolygon"===o){1<c&&t.tipLayer.setGeoText("双击结束绘制",n.x,n.y);var I=[].concat(D(u),[n]);rt.Graph.drawDashGeoPolygon(t,i,I)}else if("drawPolyline"===o){1<=c&&t.tipLayer.setGeoText("双击结束绘制",n.x,n.y);var G=[].concat(D(u),[n]);rt.Graph.drawGeoLines(t,i,G)}else"drawMask"===o&&rt.Edit.storeAndDrawMaskLines(t,n);else if(y){var k="point"===y.type?"右键删除":"双击选择编辑";t.tipLayer.setGeoText(k,n.x,n.y)}break;case"clearMask":0<c&&rt.Edit.storeAndClearMaskLines(t,n,r)}return!0},rt.Edit.modeTypeMapping={drawRect:"rect",drawPolygon:"polygon",drawPolyline:"polyline"},rt.Edit.mouseUp=function(t,e){var i=rt.Util.getMouseXY(t._container,e),r=rt.Util.screenToWorld(t,i.x,i.y),n=t.mode,o=t.startX,s=t.startY,a=i.x-o,l=i.y-s;switch(n){case"drawPoint":case"drawRect":case"drawPolygon":case"drawPolyline":case"drawMask":var h=t.activeFeature,u=t.activePoint,c=t.dragging;if(h){var d=h.points,y=h.type;if(c){t.overLayer.clear();var f=[];if(u){var p=u.type,g=u.relationNodesIndex,v=u.index,m=[];if("tmp"===p)if("rect"===y){var x=z(t,a,l);m=rt.Util.calRectNewPointsWithNodesIndexTmpPoint(t,d,g,x.dltx,x.dlty)}else"polygon"!==y&&"polyline"!==y||(m=rt.Util.calPolygonNewPointsWithNodesIndexTmpPoint(t,d,g[0],r));else if("formal"===p)if("rect"===y){var w=E(t);m=rt.Util.calRectNewPointsWithNodesIndexFormalPoint(t,d,g,v,a,l,w.flag)}else"polygon"!==y&&"polyline"!==y||(m=rt.Util.calPolygonNewPointsWithNodesIndexFormalPoint(t,d,v,a,l));f=m.points}else f=rt.Util.formatGeoPointsWithDlt(t,d,a,l);t.userGeometryEditDone&&t.userGeometryEditDone(y,t.activeFeature,f),t.dragging=!1}}else if(0<t.drawGeometryPoints.length&&"drawPoint"===n){var _=rt.Edit.getPointSize(t),C=Math.round(rt.Util.screenToWorldDistance(t,_));t.drawGeometryPoints=[t.drawGeometryPoints,0===C?1:C]}else if(0<t.drawGeometryPoints.length&&"drawRect"===n){t.overLayer.clear();var S=t.drawGeometryPoints[0],P=new rt.Geometry.Point(r.x,r.y),b=rt.Util.getRectPointsWithSAndE(S,P);Math.abs(b[0].x-b[2].x)<2||Math.abs(b[0].y-b[2].y)<2?(t.drawGeometryPoints=[],console.log("invalid points data: 绘制矩形 —— 不是有效矩形框...")):t.drawGeometryPoints=b}else if(0<t.drawGeometryPoints.length&&"drawMask"===n){var U=rt.Edit.getCanvasPixelColor(t);t.drawGeometryPoints=U,t.overLayer.clear()}break;case"clearMask":var M=rt.Edit.getUpdateMasksWithClearLine(t);t.userGeometryEditDone&&t.userGeometryEditDone("mask",M)}rt.Edit.setDrawStyle(t)},rt.Edit.mouseDblClick=function(t,e){switch(t.mode){case"drawPoint":case"drawRect":t.tipLayer.clear();break;case"drawPolyline":if(t.overLayer.clear(),t.tipLayer.clear(),t.drawGeometryPoints.pop(),2<=t.drawGeometryPoints.length){var i=rt.Edit.getMaskSize(t),r=Math.round(rt.Util.screenToWorldDistance(t,i));t.drawGeometryPoints=[t.drawGeometryPoints,0===r?1:r]}else t.drawGeometryPoints=[],console.log("invalid points data: 绘制多段线 —— 不是有效多段线...");break;case"drawPolygon":t.overLayer.clear(),t.tipLayer.clear(),t.drawGeometryPoints.pop(),3<=t.drawGeometryPoints.length||(t.drawGeometryPoints=[],console.log("invalid points data: 绘制多边形 —— 不是有效多边形..."));break;case"drawMask":t.overLayer.clear(),t.tipLayer.clear()}},rt.Edit.setDrawStyle=function(t){var e=t.overLayer.getCtx();t.globalStyle?rt.Util.setStyle(e,t.globalStyle):t.overLayer.setInitStyle()},rt.Edit.setDrawMaskStyle=function(t){var e=t.mode,i=t.overLayer.getCtx(),r=rt.Edit.getMaskSize(t),n=rt.Edit.getMaskColor(t);if("drawMask"===e){var o=rt.Util.getDpr();i.lineWidth=r*o,i.strokeStyle=n}},rt.Edit.getMaskColor=function(t){var e=t.globalStyle,i=t.overLayer;return e&&e.fillColor?e.fillColor:i.getCtxStyle().fillStyle},rt.Edit.getMaskSize=function(t){var e=t.globalStyle,i=t.overLayer;return e&&e.lineWeight?e.lineWeight:i.getCtxStyle().lineWidth},rt.Edit.getPointSize=function(t){var e=t.globalStyle;return e&&e.pointRadius?e.pointRadius:3},rt.Edit.storeAndDrawMaskLines=function(t,e,i){var r=t.overLayer,n=rt.Edit.getMaskSize(t),o=r.getCtx(),s=rt.Util.screenToWorldDistance(t,n),a=rt.Edit.getMaskColor(t);i&&(t.drawGeometryPoints=[]),t.drawGeometryPoints.push({realPoint:e,realSize:s,size:Math.ceil(s),color:a,point:{x:parseInt(e.x,10),y:parseInt(e.y,10)}});var l=t.drawGeometryPoints.map(function(t){return t.realPoint});rt.Graph.drawGeoLines(t,o,l)},rt.Edit.storeAndClearMaskLines=function(t,e,i,r){var n=rt.Edit.getMaskSize(t),o=t.getAllLayers(),s=rt.Util.screenToWorldDistance(t,n);r&&(t.drawGeometryPoints=[]);var a=rt.Edit.getToClearMaskRect(t.drawGeometryPoints,i,n);t.drawGeometryPoints.push({sPoint:i,sRect:a,point:e,size:s});for(var l=0,h=o.length;l<h;l++){var u=o[l];"maskLayer"===u.oClass&&u.clearMaskWithPosition(t.drawGeometryPoints,n)}},rt.Edit.getToClearMaskRect=function(t,e,i){var r=t.length;if(r<=1)return null;var n=t[r-1].sPoint,o=e,s=o.x-n.x,a=o.y-n.y,l=Math.sqrt(s*s+a*a),h=s/l*i,u=a/l*i;return[{x:n.x-u/2,y:n.y+h/2},{x:o.x-u/2,y:o.y+h/2},{x:o.x+u/2,y:o.y-h/2},{x:n.x+u/2,y:n.y-h/2}]},rt.Edit.getUpdateMasksWithClearLine=function(t){var e=t.drawGeometryPoints,i=t.getAllLayers(),r=[];if(!e.length)return r;for(var n=0,o=i.length;n<o;n++){var s=i[n],a=s.id;if("maskLayer"===s.oClass){var l=s.filterMasksWithClearLine(e);r.push({layerId:a,masks:l})}}return r},rt.Edit.getCanvasPixelColor=function(t){for(var e=rt.Util.getDpr(),i=rt.Edit.getMaskColor(t),r=t.overLayer,n=t.maskBounds,o=nt(n||[],4),s=o[0],a=o[1],l=o[2],h=o[3],u=r.getLayerContainer(),c=r.getCtx(),d=u.width,y=u.height,f=c.getImageData(0,0,d,y).data,p=f.length,g=[],v={},m=4*d*e,x=parseInt(p/m,10),w=[],_=void 0,C=0;C<x;C++){var S=C*m,P=S+m,b=f.slice(S,P),U=b.length/e,M=void 0,T=0,I=w;w=[];for(var G=[],k=0,D=0;k<U;k+=4*e,D++){var z=b[k],E=b[k+1],L=b[k+2],F=0!==z||0!==E||0!==L?1:0;if(1===F){var W=rt.Util.screenToWorld(t,D+.5,C+.5),A=parseInt(1e3*W.x,10)/1e3,R=parseInt(1e3*W.y,10)/1e3,B=void 0!==M&&void 0!==_,N=A-M,H=_-R;if(0===T&&(G=[]).push(A),B&&R===_&&1<N&&1===T)for(var X=1;X<N;X++){var Y=M+X;if(n&&s<=Y&&Y<=a&&R<=h&&l<=R||!n){var O=t.userCoordsTransformBeforeGeometryDrawDone?t.userCoordsTransformBeforeGeometryDrawDone({x:Y,y:R},"mask"):{x:Y,y:R};g.push([[O.x,O.y],i]),v["".concat(Y,"_").concat(R)]=!0}}if(1<H)for(var V=1;V<H;V++)for(var Z=_-V,j=0,K=I.length;j<K;j++)for(var q=nt(I[j],2),J=q[0],$=q[1],Q=J,tt=1;Q<=$;Q++,tt++)if(n&&s<=Q&&Q<=a&&Z<=h&&l<=Z||!n){var et=t.userCoordsTransformBeforeGeometryDrawDone?t.userCoordsTransformBeforeGeometryDrawDone({x:Q,y:Z},"mask"):{x:Q,y:Z};g.push([[et.x,et.y],i]),v["".concat(Q,"_").concat(Z)]=!0}if(!v["".concat(A,"_").concat(R)]&&(n&&s<=A&&A<=a&&R<=h&&l<=R||!n)){var it=t.userCoordsTransformBeforeGeometryDrawDone?t.userCoordsTransformBeforeGeometryDrawDone({x:A,y:R},"mask"):{x:A,y:R};g.push([[it.x,it.y],i]),v["".concat(A,"_").concat(R)]=!0}M=A,_=R,U-4*e<=k&&G.length&&(G.push(M),w.push(G))}else 1===T&&(G.push(M),w.push(G)),M=void 0;T=F}}return g},rt.Map=o.extend({init:function(t,e){this._options=e||{},this.destroy(t),this.privateInitContainer(t),this.privateInitProp(),this.privateInitEvent(),this.overLayer=new rt.Layer.Overlay("overlay"),this.tipLayer=new rt.Layer.Tip("tip"),this.mLayer=new rt.Layer.Marker("markerLayer"),this.addLayer(this.overLayer),this.addLayer(this.tipLayer),this.addLayer(this.mLayer),this.attachEvents(),this.attachSlots(),this.registerShortKeyEvent()},attachEvents:function(){var e=this;e.events={on:function(t,r){switch(t){case"boundsChanged":e.userBoundsChanged=function(){r()};break;case"mouseDown":e.userMouseDown=function(t){var e=r(t);return"boolean"!=typeof e||e};break;case"mouseMove":e.userMouseMove=function(t){r(t)};break;case"geometryEditing":e.userGeometryEditing=function(t,e,i){r(t,e,i)};break;case"geometryEditDone":e.userGeometryEditDone=function(t,e,i){r(t,e,i)};break;case"geometryRemove":e.userGeometryRemove=function(t,e){r(t,e)};break;case"geometryDrawDone":e.userGeometryDrawDone=function(t,e,i){r(t,e,i)};break;case"featureHover":e.userFetureHover=function(t,e,i){r(t,e,i)};break;case"featureSelected":e.userFetureSelected=function(t,e,i){r(t,e,i)};break;case"featureWillSelected":e.userFetureWillSelected=function(t,e,i){r(t,e,i)};break;case"featureStatusReset":e.userFeatureStatusReset=function(t){r(t)};break;case"resize":e.userGMapResize=function(){r()}}}}},attachSlots:function(){var e=this;e.slots={on:function(t,i){switch(t){case"coordsTransformBeforeGeometryDrawDone":e.userCoordsTransformBeforeGeometryDrawDone=function(t,e){return i(t,e)||t};break;case"coordsTransformBeforeRender":e.userCoordsTransformBeforeRender=function(t,e){return i(t,e)||t}}},off:function(t){switch(t){case"coordsTransformBeforeGeometryDrawDone":e.userCoordsTransformBeforeGeometryDrawDone=null;break;case"coordsTransformBeforeRender":e.userCoordsTransformBeforeRender=null}}}},onBoundsChanged:function(){for(var t=this.getAllControls(),e=0;e<t.length;e++)t[e].boundsWatch();this.userBoundsChanged&&this.userBoundsChanged()},registerShortKeyEvent:function(){var t=this;rt.Util.Key.addEventListener([17,90],function(){-1<["drawPolygon","drawPolyline"].indexOf(t.mode)&&t.drawGeometryPoints.length&&(t.drawGeometryPoints.pop(),rt.Edit.mouseMove(t,{x:t.middleX,y:t.middleY}))})},handleWindowResize:function(){var t=this._containerSize,e=t.clientWidth,i=t.clientHeight,r=this._container,n=r.clientWidth,o=r.clientHeight;e===n&&i===o||this.resize()},privateInitContainer:function(t){if(this._container=document.getElementById(t),this._container){this._container.innerHTML="",this.w=this._options.w||this._container.clientWidth,this.h=this._options.h||this._container.clientHeight,this._container.style.overflow="hidden",this._container.style.userSelect="none",this._container.oncontextmenu=function(){return!1};var e=this._container,i=e.clientWidth,r=e.clientHeight;this._containerSize={clientWidth:i,clientHeight:r},window.addEventListener("resize",this.handleWindowResize.bind(this))}},getContainer:function(){return this._container},getSize:function(){return{w:this.w,h:this.h}},privateInitProp:function(){this.mode="pan",this.panConfig={zoom:!0},this.dragging=!1,this.autoPanTimer=null,this.autoPanFlag=!(0<=[!0,!1].indexOf(this._options.autoPan))||this._options.autoPan,this.drawZoomFlag=!(0<=[!0,!1].indexOf(this._options.drawZoom))||this._options.drawZoom,this.autoFeatureSelect=!(0<=[!0,!1].indexOf(this._options.autoFeatureSelect))||this._options.autoFeatureSelect,this.oLayers=[],this.oControls=[],this.zoom=this._options.zoom||parseInt(1*this.w,10),this.cx=this._options.cx||0,this.cy=this._options.cy||0,this.startX=0,this.startY=0,this.startScrX=0,this.startSrcY=0,this.middleX=0,this.middleY=0,this.zoomScale=.025,this.zoomMax=this._options.zoomMax||1e9,this.zoomMin=this._options.zoomMin||0,this.drawGeometryPoints=[],this.activeFeature=null,this.activePoint=null,this.maskBounds=null,this.drawPointTimer=null},mapMouseDownForPan:function(t){this.dragging=!0;for(var e=this.getAllLayers(),i=0;i<e.length;i++)e[i].startLeft=rt.Util.delpx(e[i]._layerContainer.style.left),e[i].startTop=rt.Util.delpx(e[i]._layerContainer.style.top)},mapMouseMoveForPan:function(t){var e=rt.Util.getMousePos(t);if(this.dragging){var i=e.x-this.startScrX,r=e.y-this.startScrY,n=this.getAllLayers();if(0<Math.abs(i)||0<Math.abs(r))for(var o=0;o<n.length;o++)n[o].onDrag(i,r)}},mapMouseUpForPan:function(t){var e=rt.Util.getMousePos(t),i=e.x-this.startScrX,r=e.y-this.startScrY;if(0<Math.abs(i)||0<Math.abs(r)){var n=this.getScreenCenter(),o=n.x-i,s=n.y-r,a=rt.Util.screenToWorld(this,o,s);this.setCenter(a.x,a.y)}this.dragging=!1},mapMouseMoveForEdit:function(t){var e=this,i=rt.Util.getMouseXY(this._container,t);this.middleX=i.x,this.middleY=i.y,-1<["drawPolygon","drawRect","drawPolyline"].indexOf()&&0<this.drawGeometryPoints.length&&(i.x<=10||i.y<=10||i.x>=this.w-10||i.y>=this.h-10)&&!this.autoPanTimer&&this.autoPanFlag?this.autoPanTimer=window.setInterval(function(){return e.mapAutoPanForEdit({left:i.x<=10,right:i.x>=e.w-10,top:i.y<=10,bottom:i.y>=e.h-10})},0):this.autoPanTimer&&(window.clearInterval(this.autoPanTimer),this.autoPanTimer=null),rt.Edit.mouseMove(this,t)},mapAutoPanForEdit:function(t){var e=t.left,i=t.right,r=t.top,n=t.bottom,o=this.getScreenCenter(),s=e?-.2:i?.2:0,a=r?-.2:n?.2:0,l=o.x+s,h=o.y+a,u=rt.Util.screenToWorld(this,l,h);this.setCenter(u.x,u.y)},coordsTransformBatch:function(e,t,i){var r=this;return this[e]?t.map(function(t){return r[e](t,i)}):t},mapMouseUpForEdit:function(t){var r=this;rt.Edit.mouseUp(this,t);var e=this.drawGeometryPoints.length;if(this.overLayer.resetzIndex(),e)switch(this.mode){case"drawPoint":this.clearDrawPointTimer(),this.drawPointTimer=setTimeout(function(){var t=nt(r.drawGeometryPoints,2),e=t[0],i=t[1];r.userGeometryDrawDone&&r.userGeometryDrawDone("point",e[0],{radius:i}),r.drawGeometryPoints=[],r.clearDrawPointTimer()},200);break;case"drawRect":this.userGeometryDrawDone&&this.userGeometryDrawDone("rect",this.drawGeometryPoints),this.drawGeometryPoints=[];break;case"drawPolygon":case"drawPolyline":break;case"drawMask":this.userGeometryDrawDone&&this.userGeometryDrawDone("mask",this.drawGeometryPoints),this.drawGeometryPoints=[];break;case"clearMask":this.drawGeometryPoints=[]}},clearDrawPointTimer:function(){this.drawPointTimer&&(clearTimeout(this.drawPointTimer),this.drawPointTimer=null)},privateInitEvent:function(){var m=this,t=this._container;function e(t){var e=t||window.event;window.event||e.preventDefault();var i=rt.Util.getMouseXY(m._container,e),r=rt.Util.screenToWorld(m,i.x,i.y),n=rt.Util.getMousePos(e);m.startX=i.x,m.startY=i.y,m.startScrX=n.x,m.startScrY=n.y,"pan"===m.mode?(m.resetLayerStatus("active"),m.mapMouseDownForPan(e),document.onmousemove=function(t){m.mapMouseMoveForPan(t)},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null,m.mapMouseUpForPan(t)}):rt.Edit.mouseDown(m,e),m.userMouseDown&&m.userMouseDown(r)}function i(t){m.mapMouseMoveForEdit(t);var e=rt.Util.getMouseXY(m._container,t),i=rt.Util.screenToWorld(m,e.x,e.y);!m.dragging&&m.handleDrawEditGeometryMouseMove(i),m.userMouseMove&&m.userMouseMove(i),!m.dragging&&m.setTargets(t,i,"hover")}function r(t){m.mapMouseUpForEdit(t)}function n(t){m.clearDrawPointTimer(),"drawPoint"===m.mode&&(m.drawGeometryPoints=[]);var e=rt.Util.getMouseXY(m._container,t),i=rt.Util.screenToWorld(m,e.x,e.y);if(rt.Edit.mouseDblClick(m,t),m.drawGeometryPoints.length)switch(m.mode){case"drawPoint":case"drawRect":break;case"drawPolygon":m.userGeometryDrawDone&&m.userGeometryDrawDone("polygon",m.drawGeometryPoints),m.drawGeometryPoints=[];break;case"drawPolyline":var r=nt(m.drawGeometryPoints,2),n=r[0],o=r[1];m.userGeometryDrawDone&&m.userGeometryDrawDone("polyline",n,{width:o}),m.drawGeometryPoints=[]}else switch(m.mode){case"drawPoint":case"drawRect":case"drawPolygon":case"drawPolyline":case"drawMask":!m.activeFeature&&m.setTargets(t,i,"selected")}}function o(t){rt.Util.preventDefault(t);var e=m.drawZoomFlag,i=m.mode,r=m.panConfig,n=rt.Util.getMouseXY(m._container,t),o=rt.Util.screenToWorld(m,n.x,n.y),s=-1<["drawPolygon","drawPoint","drawPolyline","drawRect","drawMask","clearMask"].indexOf(i),a=e&&s&&r.zoom;if("pan"===m.mode&&r.zoom||a){if(0<(t.wheelDelta||-t.detail)){var l=m.getNewZoom("zoomIn",1);if(m.zoom<=m.zoomMin||l<=m.zoomMin)return;var h=(o.x-m.cx)*(1-m.zoomScale),u=(o.y-m.cy)*(1-m.zoomScale),c=o.x-h,d=o.y-u;m.setCenter(c,d,!0),m.zoomIn(1,"mouseWheel")}else{var y=m.getNewZoom("zoomOut",1);if(m.zoom>=m.zoomMax||y>=m.zoomMax)return;var f=(o.x-m.cx)/(1-m.zoomScale),p=(o.y-m.cy)/(1-m.zoomScale),g=o.x-f,v=o.y-p;m.setCenter(g,v,!0),m.zoomOut(1,"mouseWheel")}s&&m.drawGeometryPoints.length&&rt.Edit.mouseMove(m,{x:n.x,y:n.y})}}rt.Util.addEvtHandler(t,"mousedown",e),rt.Util.addEvtHandler(t,"mousemove",i),rt.Util.addEvtHandler(t,"mouseup",r),rt.Util.addEvtHandler(t,"mousewheel",o),rt.Util.addEvtHandler(t,"dblclick",n),this._mapMouseDown=e,this._mapMouseMove=i,this._mapMouseUp=r,this._mapMouseDblClick=n,this._mapMouseWheel=o},handleDrawEditGeometryMouseMove:function(o){var s=this;switch(s.mode){case"pan":s.setCursor("pointer");break;case"clearMask":s.setCursor("cell");break;case"drawPoint":case"drawRect":case"drawPolyline":case"drawMask":case"drawPolygon":if(function(){for(var t=s.getAllLayers(),e=0;e<t.length;e++)if("featureLayer"===t[e].oClass){var i=t[e].catchFeaturePointWithPos(o,"active");if(i.length)return s.activeFeature=i[0].feature,s.activePoint=i[0].point,!(s.hoverFeature=null);var r=t[e].getFeaturesWithPos(o,"active");if(r.length)return s.activeFeature=r[0],s.activePoint=null,!(s.hoverFeature=null);var n=t[e].getFeaturesWithPos(o,"hover");if(n.length)return s.activeFeature=null,s.activePoint=null,s.hoverFeature=n[0],!1}return s.activeFeature=null,s.activePoint=null,s.hoverFeature=null,!1}()){var t=s.activeFeature;if(s.activePoint&&"rect"===t.type){var e=s.activePoint.k;0<e&&e!==1/0?s.setCursor("nesw-resize"):0===e?s.setCursor("ew-resize"):e<0&&e!==-1/0?s.setCursor("nwse-resize"):s.setCursor("ns-resize")}else s.activePoint&&"polygon"===t.type?s.setCursor("no-drop"):s.activePoint&&"polyline"===t.type?s.setCursor("no-drop"):s.setCursor("move")}else s.setCursor("crosshair")}},setTargets:function(t,e,i){for(var r=this.getAllLayers(),n=[],o=0;o<r.length;o++)n=n.concat(r[o].getFeaturesWithPos(e));if("selected"===i){if(!n.length)return void this.resetLayerStatus("active");if("point"===n[0].type)return;this.autoFeatureSelect&&n[0].active(),this.handleDrawEditGeometryMouseMove(e),this.autoFeatureSelect&&this.userFetureSelected&&this.userFetureSelected(n[0],t,e),!this.autoFeatureSelect&&this.userFetureWillSelected&&this.userFetureWillSelected(n[0],t,e)}else"hover"===i&&(this.resetLayerStatus("hover"),n.length&&n[0].hover(),this.userFetureHover&&this.userFetureHover(n[0],t,e));return this},resetLayerStatus:function(t){for(var e=this.getAllLayers(),i=!1,r=0;r<e.length;r++)"featureLayer"===e[r].oClass&&e[r].resetFeatureStatus(t)&&(i=!0);return t&&"active"===t&&i&&this.userFeatureStatusReset&&this.userFeatureStatusReset(),i},addLayer:function(t){var e=this.oLayers;rt.Util.isObjInArray(e,t)||(t.onAdd(this),e.push(t))},removeLayer:function(t){for(var e=[],i=this.oLayers,r=0,n=0;r<i.length;r++)i[r]!==t?(e[n]=i[r],n++):t.onRemove(this);this.oLayers=e},getAllLayers:function(){return this.oLayers},getLayerById:function(t){for(var e=0,i=this.oLayers.length;e<i;e++){var r=this.oLayers[e];if(r.id===t)return r}return null},addControl:function(t){var e=this.oControls;rt.Util.isObjInArray(e,t)||(t.onAdd(this),e.push(t))},removeControl:function(t){for(var e=[],i=this.oControls,r=0,n=0;r<i.length;r++)i[r]!==t?(e[n]=i[r],n++):t.onRemove(this);this.oControls=e},getAllControls:function(){return this.oControls},getNewZoom:function(t,e){for(var i=e||6,r=this.zoom;0<i;)"zoomIn"===t?r-=r*this.zoomScale:r/=1-this.zoomScale,i--;return r},getZoom:function(){return this.zoom},setZoom:function(t,e){this.zoom=t,!e&&this.refresh()},zoomIn:function(t,e){var i=this.getNewZoom("zoomIn",t);if(!(this.zoom<=this.zoomMin||i<=this.zoomMin)){var r=this.getAllLayers();this.zoom=i;for(var n=0;n<r.length;n++)r[n].zoomIn(e);this.onBoundsChanged()}},zoomOut:function(t,e){var i=this.getNewZoom("zoomOut",t);if(!(this.zoom>=this.zoomMax||i>=this.zoomMax)){var r=this.getAllLayers();this.zoom=i;for(var n=0;n<r.length;n++)r[n].zoomOut(e);this.onBoundsChanged()}},setMode:function(t,e){var i=e instanceof rt.Style;switch(this.mode=t,this.drawGeometryPoints=[],t){case"pan":this.resetLayerStatus(),!i&&e&&(this.panConfig=Object.assign({},this.panConfig,e))}i&&(this.globalStyle=e)},setGlobalStyle:function(t){t&&(this.globalStyle=t)},setPanConfig:function(t){this.panConfig=Object.assign({},this.panConfig,t||{})},setMaskBounds:function(t,e,i,r){this.maskBounds=[t,e,i,r]},setCursor:function(t){var e=this._container.style.cursor;e!==t&&(this.previousCursor=e,this._container.style.cursor=t)},resetCursor:function(){this.setCursor(this.previousCursor)},getMode:function(){return this.mode},setCenter:function(t,e,i){this.cx=t,this.cy=e,!i&&this.refresh()},centerAndZoom:function(t,e){this.setCenter(t.x,t.y,!0),this.setZoom(e,!0);for(var i=this.getAllLayers(),r=0;r<i.length;r++)i[r].zoomIn();this.onBoundsChanged()},getCenter:function(){return{x:this.cx,y:this.cy}},getScreenCenter:function(){return{x:this.w/2,y:this.h/2}},resize:function(t,e){var i=this.zoom/this.w,r=t||this._container.clientWidth,n=e||this._container.clientHeight;this.zoom=i*r,this.w=r,this.h=n;for(var o=this.getAllLayers(),s=0;s<o.length;s++)o[s].resize();for(var a=this.getAllControls(),l=0;l<a.length;l++)a[l].resize();this.userGMapResize&&this.userGMapResize(this),this.onBoundsChanged()},refresh:function(){for(var t=this.getAllLayers(),e=0,i=t.length;e<i;e++)t[e].renew();this.onBoundsChanged()},destroy:function(t){var e=t?document.getElementById(t):this._container;e.innerHTML="",rt.Util.removeEvtHandler(e,"mousedown"),rt.Util.removeEvtHandler(e,"mousemove"),rt.Util.removeEvtHandler(e,"mouseup"),rt.Util.removeEvtHandler(e,"mousewheel"),rt.Util.removeEvtHandler(e,"dblclick"),window.removeEventListener("resize",this.handleWindowResize.bind(this))}}),rt.Layer=o.extend({init:function(t,e){this.id=t,this.visible=!0,this.options=e||{opacity:1,zIndex:0}},onAdd:function(t){this._map=t,this._container=t.getContainer();var e=t.getSize();this.privateInitLayerContainer(this.id,e.w,e.h),this.privateInitProp(t),this.privateInitParams(t),this._container.appendChild(this._layerContainer),this.setzIndex(),this.setOpacity(this.options.opacity)},onRemove:function(t){t.getContainer().removeChild(this._layerContainer)},privateInitProp:function(t){},privateInitParams:function(t){},onDrag:function(t,e){this._layerContainer.style.left=this.startLeft+t+"px",this._layerContainer.style.top=this.startTop+e+"px"},zoomIn:function(t){this.renew(t)},zoomOut:function(t){this.renew(t)},zoomTo:function(){this.renew()},renew:function(){this._layerContainer.style.left="0px",this._layerContainer.style.top="0px"},getSize:function(){return{w:this._layerContainer.clientWidth,h:this._layerContainer.clientHeight}},getScreenCenter:function(){return{x:parseInt(this._layerContainer.clientWidth/2,10),y:parseInt(this._layerContainer.clientHeight/2,10)}},getMap:function(){return this._map},getLayerContainer:function(){return this._layerContainer},setzIndex:function(){isNaN(this.options.zIndex)||(this._layerContainer.style.zIndex=this.options.zIndex)},setOpacity:function(t){this.getLayerContainer().style.opacity=t},resize:function(){this._layerContainer.style.width=this._map.w+"px",this._layerContainer.style.height=this._map.h+"px"},getFeaturesWithPos:function(t){return[]},deSelect:function(){}}),rt.Layer.Image=rt.Layer.extend({init:function(t,e,i,r){this._super(t,r),this._src=e,this._size=i,this.oClass="imgLayer",this.setGridInfo(r.grid)},setGridInfo:function(t){this._gridVisible=!0,this._lineClassName="layer-img-line",this._gridConfig=!!t&&Object.assign({},{rowCount:3,columnCount:3,color:"#000"},this._gridConfig||{},t),this._rowLineProps={position:"absolute",boxSizing:"border-box",height:"1px",width:"100%",left:0,borderTop:"1px solid "+this._gridConfig.color},this._columnLineProps={position:"absolute",boxSizing:"border-box",height:"100%",width:"1px",top:0,borderLeft:"1px solid "+this._gridConfig.color}},privateInitParams:function(t){},privateInitProp:function(t){var e=this;this._super(),this._mapImg||(this._mapImg=new Image),this._mapImg.style.position="absolute",this._mapImg.style.left=0,this._mapImg.style.top=0,this._mapImg.src=this._src,this._mapImg.style.width="100%",this._mapImg.style.height="100%",this._mapImg.onmousedown=function(t){t.preventDefault()},this._mapImg.onload=function(){e.setInnerContainerSize()},this._innerContainerId=this.id+"-inner-container",this._innerContainer=document.createElement("div"),this._innerContainer.id=this._innerContainerId,this._innerContainer.appendChild(this._mapImg),this._innerContainer.style.position="absolute",this._layerContainer.appendChild(this._innerContainer),this.renew()},privateInitLayerContainer:function(t,e,i){var r=rt.Util.createDiv(t,e,i,!0);r.style.zIndex=2,this._layerContainer=r},onAdd:function(t){this._super(t),this.setGrid()},zoomTo:function(){},setGrid:function(){var t=this._gridConfig||{},e=t.columnCount,i=void 0===e?0:e,r=t.rowCount,n=void 0===r?0:r;if(this.removeGrid(),this._gridConfig&&this._gridVisible){for(var o=parseInt(100/n*100,10)/100,s=parseInt(100/i*100,10)/100,a=0;a<n-1;a++){var l=document.createElement("div");for(var h in l.className=this._lineClassName,this._rowLineProps)l.style[h]=this._rowLineProps[h];l.style.top=(a+1)*o+"%",this._innerContainer.appendChild(l)}for(var u=0;u<i-1;u++){var c=document.createElement("div");for(var d in c.className=this._lineClassName,this._columnLineProps)c.style[d]=this._columnLineProps[d];c.style.left=(u+1)*s+"%",this._innerContainer.appendChild(c)}}},operateGrid:function(t){var e=document.getElementById(this._innerContainerId);if(e)for(var i=e.getElementsByClassName(this._lineClassName),r=i.length-1;0<=r;r--)"remove"===t&&i[r].remove(),"show"===t&&(i[r].style.display="block"),"hide"===t&&(i[r].style.display="none")},removeGrid:function(){this.operateGrid("remove")},showGrid:function(){this.operateGrid("show")},hideGrid:function(){this.operateGrid("hide")},update:function(t){t&&t.grid&&(this.setGridInfo(t.grid),this.setGrid())},renew:function(){this._super(),this.setInnerContainerSize();var t=rt.Util.worldToScreen(this._map,-1*this._size.w/2,this._size.h/2);this._innerContainer.style.left=t.x+"px",this._innerContainer.style.top=t.y+"px"},setInnerContainerSize:function(){var t=this._map.getSize(),e=this._map.zoom/t.w;this._innerContainer.style.width=this._size.w/e+"px",this._innerContainer.style.height=this._size.h/e+"px"},resize:function(){this._super(),this.renew()},refresh:function(){}}),rt.Layer.Feature=rt.Layer.extend({init:function(t,e){e=e||{},this._super(t,e),this.featureStyle=e.style||new rt.Style({}),this.featureHoverStyle=e.hoverStyle||new rt.Style({strokeColor:"#FF0000",lineWeight:1}),this.featureActiveStyle=e.activeStyle||new rt.Style({strokeColor:"#FF0000",lineWeight:1}),this._opacity=!!e.transparent&&e.transparent,this.oClass="featureLayer"},privateInitLayerContainer:function(t,e,i){var r=rt.Util.createCanvas(t,e,i,!0);this._layerContainer=r,this._ctx=r.getContext("2d"),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},privateInitProp:function(t){this._super()},onAdd:function(t){var e=(this._map=t).getSize(),i=this._map.getContainer();this.privateInitLayerContainer(this.id,e.w,e.h),i.appendChild(this._layerContainer),this.setzIndex(),this.oFeatures=[]},addFeature:function(t){var e=this.getAllFeatures();rt.Util.isInArray(e,t)||(e.push(t),t.onAdd(this))},getFeatureById:function(t){for(var e=this.getAllFeatures(),i=e.length-1;0<=i;i--)if(e[i].id===t)return e[i];return null},getFeaturesWithPos:function(t,e){for(var i=[],r=this.getAllFeatures(),n=r.length-1;0<=n;n--){var o=r[n],s=!0;e&&"active"===e&&(s=o.activeStatus),e&&"hover"===e&&(s=!0),o.isCaught(t)&&s&&i.push(o)}return i},catchFeaturePointWithPos:function(t,e){for(var i=[],r=this.getAllFeatures(),n=r.length-1;0<=n;n--){var o=r[n],s=!0;e&&"active"===e&&(s=o.activeStatus);var a=o.catchPointWithPos(t);a.flag&&s&&i.push({feature:o,point:a.point})}return i},resetFeatureStatus:function(t){for(var e=this.getAllFeatures(),i=!1,r=e.length-1;0<=r;r--){var n=e[r];t&&"active"===t?n.activeStatus&&(i=!(n.activeStatus=!1)):t&&"hover"===t?n.hoverStatus&&(i=!(n.hoverStatus=!1)):(n.activeStatus||n.hoverStatus)&&(n.activeStatus=!1,i=!(n.hoverStatus=!1))}return i&&this.renew(),i},getActiveFeatures:function(){for(var t=[],e=this.getAllFeatures(),i=e.length-1;0<=i;i--)e[i].activeStatus&&t.push(e[i]);return t},getHoverFeatures:function(){for(var t=[],e=this.getAllFeatures(),i=e.length-1;0<=i;i--)e[i].hoverStatus&&t.push(e[i]);return t},removeAllFeatures:function(){this.oFeatures=[],this.renew()},removeFeature:function(t){for(var e=[],i=0,r=0;i<this.oFeatures.length;i++)this.oFeatures[i]!==t?(e[r]=this.oFeatures[i],r++):t.onRemove(this);this.oFeatures=e,this.renew()},removeFeatureById:function(t){for(var e=[],i=0,r=this.oFeatures.length;i<r;i++){var n=this.oFeatures[i];n.id!==t?e.push(n):n.onRemove(this)}this.oFeatures=e,this.renew()},removeFeaturesByIds:function(t){for(var e=[],i=[],r=0,n=this.oFeatures.length;r<n;r++){var o=this.oFeatures[r];-1===t.indexOf(o.id)?e.push(o):(o.onRemove(this),i.push(o))}return this.oFeatures=e,this.renew(),i},removeFeaturesByProperty:function(t){for(var e=[],i=[],r=0,n=this.oFeatures.length;r<n;r++){for(var o=this.oFeatures[r],s=!1,a=0,l=t.length;a<l;a++){var h=t[a];if(o.data[h.key]===h.value){s=!0,o.onRemove(this),i.push(o);break}}s||e.push(o)}return this.oFeatures=e,this.renew(),i},draw:function(){for(var t=this.getAllFeatures(),e=0;e<t.length;e++)t[e].onDraw(this)},renew:function(){this._super(),this.clear(),this.draw()},resize:function(){this._super();var t=rt.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},clear:function(){var t=this.getLayerContainer();this._ctx.clearRect(0,0,t.width,t.height)},getAllFeatures:function(){return this.oFeatures},getCtx:function(){return this._ctx}}),rt.Layer.Overlay=rt.Layer.Feature.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:10},this.zIndexTopFlag=!1,this.oClass="overlayLayer"},setStyle:function(t){this.style=t},initStyle:function(){this.setInitStyle(),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},setInitStyle:function(){var t=this.getCtx(),e=rt.Util.getDpr();t.strokeStyle="#0000FF",t.fillStyle="#0000FF",t.lineWidth=1*e,t.globalAlpha=.7},getCtxStyle:function(){var t=this.getCtx();return{strokeStyle:t.strokeStyle,fillStyle:t.fillStyle}},setEditStyle:function(){var t=this.getCtx(),e=rt.Util.getDpr();t.strokeStyle="#FF0000",t.lineWidth=1*e,t.globalAlpha=.7},onAdd:function(t){this._super(t),this.initStyle()},resize:function(){this._super();var t=rt.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},topzIndex:function(){this.zIndexTopFlag||(this._layerContainer.style.zIndex=9999,this.zIndexTopFlag=!0)},resetzIndex:function(){this.zIndexTopFlag&&(this._layerContainer.style.zIndex=this.options.zIndex,this.zIndexTopFlag=!1)}}),rt.Layer.Tip=rt.Layer.Feature.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:11},this.oClass="tipLayer"},setStyle:function(t){this.style=t},initStyle:function(){this.setInitStyle(),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},setInitStyle:function(){var t=this.getCtx(),e=12*rt.Util.getDpr();t.font="".concat(e,"px Arial"),t.textAlign="left",t.textBaseline="bottom",t.fillStyle="#fff",t.globalAlpha=1},onAdd:function(t){this._super(t),this.initStyle()},resize:function(){this._super();var t=rt.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},setTextBackground:function(t,e,i,r){var n=this.getCtx();n.beginPath(),n.rect(t,e,i,r),n.fillStyle="#333",n.fill(),n.lineWidth=1,n.strokeStyle="#efefef",n.stroke()},setText:function(t,e,i){if(this.clear(),t){var r=this.getCtx(),n=r.measureText(t).width,o=rt.Util.transformScreenXYWithDpr({x:e||0,y:i||0}),s=rt.Util.getDpr();this.setTextBackground(o.x+4*s,o.y-16*s,n+7*s,20*s),this.setInitStyle(),r.fillText(t,o.x+7*s,o.y+1*s)}},setGeoText:function(t,e,i){if(this.clear(),t){var r=this.getCtx(),n=r.measureText(t).width,o=rt.Util.worldToScreen(this._map,e||0,i||0),s=rt.Util.transformScreenXYWithDpr(o),a=rt.Util.getDpr();this.setTextBackground(s.x+4*a,s.y-16*a,n+7*a,20*a),this.setInitStyle(),r.fillText(t,s.x+7*a,s.y+1*a)}}}),rt.Layer.Mask=rt.Layer.extend({init:function(t,e){e=e||{},this._super(t,e),this._opacity=!!e.transparent&&e.transparent,this.oClass="maskLayer",this.toClearMasks=[]},privateInitLayerContainer:function(t,e,i){var r=rt.Util.createCanvas(t,e,i,!0);this._layerContainer=r,this._ctx=r.getContext("2d"),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},privateInitProp:function(t){this._super()},onAdd:function(t){var e=(this._map=t).getSize(),i=this._map.getContainer();this.privateInitLayerContainer(this.id,e.w,e.h),i.appendChild(this._layerContainer),this.setzIndex(),this.setOpacity(this.options.opacity),this.oMasks=[]},addMasks:function(t,e){e&&(this.clear(),this.oMasks=[]),this.oMasks=[].concat(D(this.oMasks),D(t)),this.renew()},renew:function(t){this._super(),this.clear(),"mouseWheel"===t?this.drawTimer():this.draw()},resize:function(){this._super();var t=rt.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},clear:function(){var t=this.getLayerContainer();this._ctx.clearRect(0,0,t.width,t.height)},getAllMasks:function(){return this.oMasks},getCtx:function(){return this._ctx},coordsTransform:function(t){return this._map.userCoordsTransformBeforeRender?this._map.userCoordsTransformBeforeRender(t,"mask"):t},drawTimer:function(t){this._drawTimer&&(clearTimeout(this._drawTimer),this._drawTimer=null);var e=this;this._drawTimer=setTimeout(function(){e.draw(t)},333)},draw:function(t){for(var e=t||this.getAllMasks(),i=rt.Util.getDpr(),r=rt.Util.worldToScreenDistance(this._map,1),n=Math.ceil(r*i),o=0,s=e.length;o<s;o++){var a=nt(e[o],2),l=a[0],h=a[1],u=this.coordsTransform({x:l[0],y:l[1]}),c=u.x,d=u.y,y=rt.Util.worldToScreen(this._map,c,d),f=parseInt(y.x*i-r*i/2,10),p=parseInt(y.y*i-r*i/2,10);this._ctx.fillStyle=h||"#FF0000",this._ctx.fillRect(f,p,n,n)}},clearMaskWithPosition:function(t,e){var i=t.length;if(!(i<1)){var r=this.getLayerContainer(),n=rt.Util.getDpr(),o=Math.ceil(e*n),s=Math.ceil(o/2),a=t[i-1].sPoint;rt.Graph.clearArc(a.x*n,a.y*n,s,this._ctx,r.width,r.height);var l=t[i-1].sRect;l&&rt.Graph.clearPolygon(l,this._ctx,r.width,r.height)}},filterMasksWithClearLine:function(p){var g=this,t=this.oMasks,v=p.length;return v?t.filter(function(t){for(var e=nt(t,1)[0],i=g.coordsTransform({x:e[0],y:e[1]}),r=i.x,n=i.y,o=rt.Util.worldToScreen(g._map,r,n),s=0;s<v;s++){var a=p[s],l=a.point,h=l.x,u=l.y,c=Math.ceil(a.size/2),d=Math.abs(h-r),y=Math.abs(u-n);if(Math.sqrt(Math.pow(d,2)+Math.pow(y,2))<=c)return!1;var f=a.sRect;if(f&&rt.Util.pointInPoly(o,f))return!1}return!0}):t}}),rt.Layer.Marker=rt.Layer.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:20},this.id=t,this.oClass="markerLayer",this.oMarkers=[]},privateInitLayerContainer:function(t,e,i){var r=rt.Util.createDiv(t,e,i,!0);this._layerContainer=r},addMarker:function(t){rt.Util.isInArray(this.oMarkers,t)||(this.oMarkers.push(t),t.onAdd(this))},removeMarker:function(t){for(var e=[],i=0,r=0;i<this.oMarkers.length;i++)this.oMarkers[i]!==t?(e[r]=this.oMarkers[i],r++):this.oMarkers[i].onRemove(this);this.oMarkers=e,this.renew()},removeMarkerById:function(t){for(var e=[],i=0,r=this.oMarkers.length;i<r;i++){var n=this.oMarkers[i];n.id!==t?e.push(n):n.onRemove(this)}this.oMarkers=e,this.renew()},removeMarkersByIds:function(t){for(var e=[],i=[],r=0,n=this.oMarkers.length;r<n;r++){var o=this.oMarkers[r];-1===t.indexOf(o.id)?e.push(o):(o.onRemove(this),i.push(o))}return this.oMarkers=e,this.renew(),i},getAllMarkers:function(){return this.oMarkers},getMarkerById:function(t){for(var e=0;e<this.oMarkers.length;e++)if(this.oMarkers[e].id===t)return this.oMarkers[e];return null},addMarkers:function(t){for(var e=0;e<t.length;e++)this.addMarker(t[e])},removeMarkers:function(t){for(var e=t,i=e.length,r=0;r<i;r++){var n=e[r];this.removeMarker(n)}},removeAllMarkers:function(){var t=this.oMarkers;this.removeMarkers(t)},renew:function(){this._super();for(var t=0;t<this.oMarkers.length;t++)this.oMarkers[t].renew()},resize:function(){this._super(),this.renew()}}),rt.Layer.Text=rt.Layer.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:19},this.id=t,this.oClass="textLayer",this.oTexts=[]},privateInitLayerContainer:function(t,e,i){var r=rt.Util.createDiv(t,e,i,!0);this._layerContainer=r},addText:function(t){rt.Util.isInArray(this.oTexts,t)||(this.oTexts.push(t),t.onAdd(this))},removeText:function(t){for(var e=[],i=0,r=0;i<this.oTexts.length;i++)this.oTexts[i]!==t?(e[r]=this.oTexts[i],r++):this.oTexts[i].onRemove(this);this.oTexts=e,this.renew()},getTextById:function(t){for(var e=0;e<this.oTexts.length;e++)if(this.oTexts[e].id===t)return this.oTexts[e];return null},removeTextById:function(t){for(var e=[],i=0,r=this.oTexts.length;i<r;i++){var n=this.oTexts[i];n.id!==t?e.push(n):n.onRemove(this)}this.oTexts=e,this.renew()},removeTextsByIds:function(t){for(var e=[],i=[],r=0,n=this.oTexts.length;r<n;r++){var o=this.oTexts[r];-1===t.indexOf(o.id)?e.push(o):(o.onRemove(this),i.push(o))}return this.oTexts=e,this.renew(),i},addTexts:function(t){for(var e=0;e<t.length;e++)this.addText(t[e])},removeTexts:function(t){for(var e=t,i=e.length,r=0;r<i;r++){var n=e[r];this.removeText(n)}},getAllTexts:function(){return this.oTexts},removeAllTexts:function(){this._layerContainer.innerHTML="",this.oTexts=[],this.renew()},renew:function(){this._super();for(var t=0;t<this.oTexts.length;t++)this.oTexts[t].renew()},resize:function(){this._super(),this.renew()}}),rt.Control=o.extend({init:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=(new Date).getTime()+"";this.id=t||i,this._controlContainer=this.generateContainer(),this._controlContainer.id=t,this.setControlContainerPosition(e)},setControlContainerPosition:function(t){this._postion=t.postion||t.pos||{right:0,bottom:0};var e=this._postion,i=e.left,r=e.top,n=e.right,o=e.bottom;this._controlContainer.style.position="absolute",this._controlContainer.style.display="inline-block",this._controlContainer.style.zIndex=999999,!isNaN(i)&&(this._controlContainer.style.left=i+"px"),isNaN(i)&&(this._controlContainer.style.left="auto"),!isNaN(r)&&(this._controlContainer.style.top=r+"px"),isNaN(r)&&(this._controlContainer.style.top="auto"),!isNaN(n)&&(this._controlContainer.style.right=n+"px"),isNaN(n)&&(this._controlContainer.style.right="auto"),!isNaN(o)&&(this._controlContainer.style.bottom=o+"px"),isNaN(o)&&(this._controlContainer.style.bottom="auto")},generateContainer:function(){return document.createElement("div")},setVisible:function(t){this.visible=t,this.refresh&&this.refresh()},show:function(){this.visible||this.setVisible(!0)},hide:function(){this.visible&&this.setVisible(!1)},onAdd:function(t){this._map=t,this.visible=!0;var e=this.selfContainer||this.getMapContainer();if(!e||!this._controlContainer)return!1;this.selfContainer&&(this._controlContainer.style.position="relative"),e.appendChild(this._controlContainer)},onRemove:function(){var t=this.selfContainer||this.getMapContainer();if(!t||!this._controlContainer)return!1;try{t.removeChild(this._controlContainer)}catch(t){console.log("ailabel-control-removechild-error")}},getMapContainer:function(){return this._map?this._map.getContainer():null},getMapContainerSize:function(){return this._map?{w:this._map.w,h:this._map.h}:null},getMapZoomScale:function(){var t=this.getMapContainer(),e=this.getMapZoom(),i=(this.getMapContainerSize()||{}).w;return!!(t&&e&&i)&&e/i},getMapZoom:function(){if(this._map)return this._map.getZoom()},getMapHZoom:function(){var t=this.getMapZoomScale(),e=this.getMapContainerSize();if(t&&e)return t*e.h},getContainerInfo:function(){this._map},boundsWatch:function(){},resize:function(){this.refresh()},refresh:function(){this.onDraw()}}),rt.Control.Scale=rt.Control.extend({init:function(t,e){var i=e||{};this._super(t,i),this._style=i.style||new rt.Style({opacity:0}),this.type="scale"},onAdd:function(t){this._super(t),this.setContainerProps(),this.onDraw(t)},onDraw:function(){var t=this.getMapZoomScale();t&&this.setScaleContent(t)},setContainerProps:function(){if(!this._controlContainer)return console.warn("controlContainer不存在：setContainerProps:function"),!1;var t=this._style;this._controlContainer.style.fontSize=t.fontSize+"px",this._controlContainer.style.fontFamily=t.fontFamily+",SimSun",this._controlContainer.style.color=t.fontColor,this._controlContainer.style.padding="2px";var e=t.opacity||0===t.opacity?t.opacity:1,i=rt.Util.colorRgb(t.bgColor,e);this._controlContainer.style.background=i},setScaleContent:function(t){if(!this._controlContainer)return console.warn("controlContainer不存在：setScaleContent:function"),!1;var e=parseInt(100*t,10)+"/100";this._controlContainer.textContent=e||"--/--"},boundsWatch:function(){this._super(),this.onDraw()}}),rt.Control.EagleMap=rt.Control.extend({init:function(t,e){var i=e||{};this._super(t,i),this.type="eagleMap",this._image=i.image||{src:"",width:0,height:0},this._imageId="image-"+t,this._size=i.size||{width:200,height:150},this._type=-1<["default","grid"].indexOf(i.type)?i.type:"default",this._activeGridElement=null,i.container&&document.getElementById(i.container)&&(this.selfContainer=document.getElementById(i.container)),this._controlContainerBorderWidth=1,this._controlContainerProps=function(n){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},e=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),e.forEach(function(t){var e,i,r;e=n,r=o[i=t],i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r})}return n}({display:"-webkit-box",webkitBoxPack:"center",webkitBoxAlign:"center",boxSizing:"border-box",borderRadius:"0",overflow:"hidden",zIndex:999999,border:this._controlContainerBorderWidth+"px solid #eaeaea"},"grid"===this._type?{backgroundColor:"#000"}:{}),this._highlightProps={border:"2px solid #ff0000",borderRadius:"2px",position:"absolute",boxSizing:"border-box",left:0,top:0,width:0,height:0},this._gridConfig=!!i.grid&&Object.assign({},{rowCount:3,columnCount:3,color:"#000"},i.grid),this._gridProps={position:"absolute",left:"50%",top:"50%",width:0,height:0};var r=this._gridConfig||{},n=r.columnCount,o=void 0===n?1:n,s=r.rowCount,a=void 0===s?1:s,l=r.color,h=void 0===l?"#000":l;this._gridCellProps="default"===this._type?{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",float:"left",border:"0 solid "+h,cursor:"pointer",width:100/o+"%",height:100/a+"%",borderRightWidth:"1px",borderBottomWidth:"1px"}:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",float:"left",border:"0 solid "+h,cursor:"pointer",width:100/o+"%",height:100/a+"%",borderRightWidth:"2px",borderBottomWidth:"2px",backgroundColor:"rgba(255, 255, 255, .2)"}},onAdd:function(t){this.selfContainer&&(this.selfContainer.innerHTML=""),this._super(t),this.setContainerProps(),this.setPropsRelatedWithImageInfo(),"default"===this._type&&(this.addImage(),this.addHighlightRect()),this.addGrid(),this.onDraw(t)},setPropsRelatedWithImageInfo:function(){var t=this._image,e=t.width,i=t.height,r=this._size,n=r.width,o=r.height;this._zoom=n/o<=e/i?(this._imageScreenWidth=n,this._imageScreenHeight=i*n/e,e):(this._imageScreenWidth=e*o/i,this._imageScreenHeight=o,e*n/this._imageScreenWidth)},addImage:function(){var t=this._image,e=t.src,i=t.width,r=t.height,n=this._size,o=n.width,s=n.height;this._mapImg=document.createElement("img"),this._mapImg.id=this._imageId,this._mapImg.src=e,o/s<=i/r?this._mapImg.style.width="100%":this._mapImg.style.height="100%",this._mapImg.style.display="block",this._mapImg.style.margin="0 auto",this._controlContainer.appendChild(this._mapImg)},addHighlightRect:function(){for(var t in this._highlight=document.createElement("div"),this._highlightProps)this._highlight.style[t]=this._highlightProps[t];this._controlContainer.appendChild(this._highlight)},changeHighlightRectSize:function(t,e){if(!this._highlight)return!1;this._highlight.style.width=t+"px",this._highlight.style.height=e+"px"},changeHighlightRectPosition:function(t,e){if(!this._highlight)return!1;var i=-this._controlContainerBorderWidth;this._highlight.style.left=t+i+"px",this._highlight.style.top=e+i+"px"},addGrid:function(){var t=this._imageScreenWidth,e=this._imageScreenHeight;if(this._grid=document.createElement("div"),this._grid.className="ailabel-control-eagle-map-grid","default"===this._type){if(!this._gridConfig||!t||!e)return;this._gridProps.width=t+"px",this._gridProps.height=e+"px",this._gridProps.marginLeft=-t/2+"px",this._gridProps.marginTop=-e/2+"px"}else{if(!this._gridConfig)return;this._gridProps.width="100%",this._gridProps.height="100%",this._gridProps.left=0,this._gridProps.top=0}for(var i in this._gridProps)this._grid.style[i]=this._gridProps[i];for(var r=this._gridConfig,n=r.columnCount,o=r.rowCount,s=0;s<o;s++)for(var a=0;a<n;a++){var l=document.createElement("div");for(var h in this._gridCellProps)l.style[h]=this._gridCellProps[h];a+1===n&&(l.style.borderRightWidth=0),s+1===o&&(l.style.borderBottomWidth=0),"grid"===this._type&&(l.innerHTML='<svg t="1573368358416" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7399" width="80%" height="80%"><path d="M289 802.2l190.7-190.7-67.9-67.9-186.1 186.1V571l-96 0.1v327l0.1 0.1 327 0.1v-96l-167.8-0.1z m-63.3-2.6l2.6 2.6h-2.6v-2.6z m671.2-671.2l-327.1 0.1v95.8l161.2 0.1-189.7 189.7 67.9 67.9L801 290.2v165.3l95.9 0.1V128.5z" fill="#fff" p-id="7400"></path></svg>'),l.setAttribute("data-row",s+1),l.setAttribute("data-column",a+1),this.bindGridCellHoverStyle(l),this.bindGridCellEvent(l),this._grid.appendChild(l)}this._controlContainer.appendChild(this._grid)},bindGridCellHoverStyle:function(t){var e=this;t.onmouseover=function(){"default"===e._type&&(this.style.boxShadow="0 2px 2px gray")},t.onmouseout=function(){"default"===e._type&&(this.style.boxShadow="none")}},bindGridCellEvent:function(t){var d=this,e=d.getMapZoom(),y=d.getMapContainerSize();d._map&&e&&y&&(t.onclick=function(){var t=1*this.getAttribute("data-row"),e=1*this.getAttribute("data-column"),i=d.getGridCellCenter(t,e),r=i.x,n=i.y,o=y.w,s=y.h,a=d.getGridCellWordWidthAndHeight(),l=a.width,h=a.height,u=o/s<=l/h?1.2*l:o/s*h*1.2;if(d._map.centerAndZoom({x:r,y:n},u),"grid"===d._type){this.style.backgroundColor="rgba(16,140,238,.2)",d._activeGridElement&&(d._activeGridElement.style.border=""),(d._activeGridElement=this).style.border="1px solid red";var c=this.querySelector("svg path");c&&(c.style.fill="#108CEE")}})},getGridCellCenter:function(t,e){var i=this._gridConfig||{},r=i.columnCount,n=void 0===r?1:r,o=i.rowCount,s=void 0===o?1:o,a=this.getGridCellWordWidthAndHeight(),l=a.width,h=a.height;return{x:(e-n/2)*l-l/2,y:(s/2-t)*h+h/2}},getGridCellWordWidthAndHeight:function(){var t=this.getGridCellScreenWidthAndHeight(),e=t.width,i=t.height,r=this.getEagleMapScale();return{width:r*e,height:r*i}},getGridCellScreenWidthAndHeight:function(){var t=this._gridConfig||{},e=t.columnCount,i=void 0===e?1:e,r=t.rowCount,n=void 0===r?1:r;return{width:this._imageScreenWidth/i,height:this._imageScreenHeight/n}},onDraw:function(){var t=this.getMapZoom(),e=this.getMapHZoom(),i=this.getEagleMapScale();if(!t||!e||!i)return!1;var r=parseInt(t/i,10),n=parseInt(e/i,10);this.changeHighlightRectSize(r,n);var o=this.getLeftTopWordPosition();this.changeHighlightRectPosition(o.x,o.y)},getEagleMapScale:function(){var t=this._size.width;return this._zoom/t},setContainerProps:function(){if(!this._controlContainer)return console.warn("controlContainer不存在：setContainerProps:function"),!1;for(var t in this._controlContainer.onclick=function(t){t.stopPropagation(),t.cancelBubble=!0},this._controlContainerProps)this._controlContainer.style[t]=this._controlContainerProps[t];this._controlContainer.style.width=this._size.width+"px",this._controlContainer.style.height=this._size.height+"px"},getLeftTopWordPosition:function(){var t=rt.Util.screenToWorld(this._map,0,0),e=this._size,i=e.width,r=e.height,n=this.getEagleMapScale(),o=parseInt(i,10)/2,s=parseInt(r,10)/2;return{x:parseFloat(o)+parseFloat((t.x-0)/n)+0,y:parseFloat(s)-parseFloat((t.y-0)/n)+0}},boundsWatch:function(){this._super(),this.onDraw(),this._activeGridElement&&(this._activeGridElement.style.border="")}}),rt});